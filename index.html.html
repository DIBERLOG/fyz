<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Полная карта физики с исправлениями</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
   
    html, body, #map {
      height: 100%;
      margin: 0;
      background: #000;
      font-family: 'Arial', sans-serif;
    }
    .filter-container {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      border-radius: 8px;
      padding: 15px;
      color: white;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      max-width: 300px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .filter-header {
      margin: 0 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      font-size: 16px;
      font-weight: bold;
    }
    .filter-group {
      margin-bottom: 15px;
    }
    .filter-group-title {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .filter-group-title::before {
      content: "▼";
      font-size: 10px;
      margin-right: 8px;
      transition: transform 0.2s;
    }
    .filter-group.collapsed .filter-group-title::before {
      transform: rotate(-90deg);
    }
    .filter-group.collapsed .filter-options {
      display: none;
    }
    .filter-options {
      display: block;
    }
    .filter-option {
      display: flex;
      align-items: center;
      margin: 5px 0;
      padding: 5px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .filter-option:hover {
      background: rgba(255,255,255,0.1);
    }
    .filter-option input {
      margin-right: 8px;
    }
    .filter-option .color-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      border: 1px solid rgba(255,255,255,0.5);
    }
    .search-box {
      margin-bottom: 15px;
    }
    .search-box input {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: none;
      background: rgba(255,255,255,0.9);
    }
    .node-tooltip {
      font-size: 12px;
      background: rgba(0,0,0,0.7);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      padding: 4px 8px;
      white-space: nowrap;
    }
    .node-label {
      position: absolute;
      color: white;
      font-size: 11px;
      text-shadow: 0 0 2px black;
      pointer-events: none;
      white-space: nowrap;
      transform: translate(-50%, 0);
      z-index: 500;
      opacity: 0.9;
      transition: opacity 0.3s ease, font-size 0.3s ease;
    }
    .zone-label {
      color: #fff;
      font-weight: bold;
      text-shadow: 0 0 2px #000;
      font-size: 13px;
      opacity: 0.8;
      transition: opacity 0.3s ease, font-size 0.3s ease;
    }
    .leaflet-tooltip.zone-label {
      background: transparent;
      border: none;
      box-shadow: none;
    }
    .outer-stroke {
      stroke: #000;
      stroke-width: 2;
    }
    
    /* Обновлённые стили модального окна */
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #222;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      color: #eee;
      width: 700px;
      max-width: 90%;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #1a1a1a;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-header h2 {
      margin: 0;
      font-size: 22px;
      color: #fff;
    }

    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0 10px;
      transition: opacity 0.2s;
    }

    .close-btn:hover {
      opacity: 0.8;
    }

    /* Уменьшенная карусель изображений */
    .image-carousel {
      width: 100%;
      height: 45vh;
      min-height: 300px;
      overflow: hidden;
      background: #2a2a2a;
      position: relative;
    }

    .carousel-inner {
      display: flex;
      height: 100%;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .carousel-item {
      min-width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      flex-shrink: 0;
    }

    .carousel-item img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 4px;
    }

    /* Упрощённые элементы управления */
    .carousel-control {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      background: rgba(0, 0, 0, 0.3);
      cursor: pointer;
      z-index: 10;
      font-size: 28px;
      user-select: none;
      transition: background 0.3s;
    }

    .carousel-control:hover {
      background: rgba(0, 0, 0, 0.5);
    }

    .carousel-control.prev {
      left: 0;
    }

    .carousel-control.next {
      right: 0;
    }

    .carousel-indicators {
      position: absolute;
      bottom: 15px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 10;
    }

    .carousel-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.3s;
    }

    .carousel-indicator.active {
      background: white;
      transform: scale(1.2);
    }

    /* Контент модального окна */
    .item-content {
      padding: 20px;
      overflow-y: auto;
      background: #1e1e1e;
      border-top: 1px solid #333;
    }

    .additional-info {
      margin-top: 15px;
      padding: 15px;
      background: #252525;
      border-radius: 6px;
    }

    .additional-info h3 {
      margin: 0 0 10px 0;
      color: #6bc1ff;
      font-size: 16px;
    }

    .additional-info p {
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
      color: #ccc;
    }

    /* Дополнительные модальные окна */
    .additional-modals {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }

    .additional-modal {
      background: #2a2a2a;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .additional-modal:hover {
      background: #333;
      transform: translateY(-2px);
    }

    .additional-modal h3 {
      margin: 0 0 8px 0;
      color: #6bc1ff;
      font-size: 16px;
    }

    .additional-modal p {
      margin: 0;
      font-size: 14px;
      line-height: 1.4;
      color: #ccc;
    }

    /* Адаптивность */
     /* Адаптивность */
    @media (max-width: 768px) {
      .modal-content {
        width: 95%;
        max-height: 90vh;
      }
      
      .image-carousel {
        height: 40vh;
        min-height: 250px;
      }
      
      .carousel-control {
        width: 40px;
        font-size: 24px;
      }
    }

    @media (max-width: 480px) {
      .image-carousel {
        height: 35vh;
        min-height: 200px;
      }
      
      .modal-header h2 {
        font-size: 18px;
      }
      
      .additional-info h3 {
        font-size: 15px;
      }
    }

    /* Цвета тегов */
    .type-1 {
      background-color: rgba(185, 107, 255, 0.2);
      color: #b96bff;
    }
    
    .type-2 {
      background-color: rgba(107, 255, 154, 0.2);
      color: #6bff9a;
    }
    
    .type-3 {
      background-color: rgba(255, 216, 107, 0.2);
      color: #ffd86b;
    }
    
    .type-4 {
      background-color: rgba(107, 193, 255, 0.2);
      color: #6bc1ff;
    }
    
    /* Подсветка связей */
    .highlighted-connection {
      stroke: #fff !important;
      stroke-opacity: 1 !important;
      stroke-width: 2 !important;
      transition: all 0.3s ease;
    }
    .dimmed-connection {
      stroke-opacity: 0.2 !important;
      transition: all 0.3s ease;
    }
    .highlighted-node {
      opacity: 1 !important;
      stroke: #fff !important;
      stroke-width: 2 !important;
      transition: all 0.3s ease;
    }
    .dimmed-node {
      opacity: 0.2 !important;
      transition: all 0.3s ease;
    }
    .faded-element {
      transition: opacity 0.3s ease;
    }
    .hidden-element {
      opacity: 0 !important;
      pointer-events: none !important;
    }



  </style>
</head>
<body>
  <div id="map"></div>
  
  <div class="filter-container">
    <div class="filter-header">Фильтр карты физики</div>
    
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Поиск по всем темам...">
    </div>
    
    <div class="filter-group">
      <div class="filter-group-title">Основные разделы</div>
      <div class="filter-options">
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Философия" checked>
          <span class="color-indicator" style="background: #6bc1ff;"></span>
          Философия
        </label>
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Классическая физика" checked>
          <span class="color-indicator" style="background: #ff6b6b;"></span>
          Классическая физика
        </label>
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Квантовая физика" checked>
          <span class="color-indicator" style="background: #b96bff;"></span>
          Квантовая физика
        </label>
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Теория относительности" checked>
          <span class="color-indicator" style="background: #6bff9a;"></span>
          Теория относительности
        </label>
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Будущее физики" checked>
          <span class="color-indicator" style="background: #ffd86b;"></span>
          Будущее физики
        </label>
        <label class="filter-option">
          <input type="checkbox" class="category-filter" value="Пропасть незнания" checked>
          <span class="color-indicator" style="background: #1f3d2d;"></span>
          Пропасть незнания
        </label>
      </div>
    </div>
    
    <div class="filter-group">
      <div class="filter-group-title">Типы элементов</div>
      <div class="filter-options">
        <label class="filter-option">
          <input type="checkbox" class="element-filter" value="subtopics" checked>
          Подтемы
        </label>
        <label class="filter-option">
          <input type="checkbox" class="element-filter" value="connections" checked>
          Связи
        </label>
        
        <label class="filter-option">
          <input type="checkbox" class="element-filter" value="nodes" checked>
          Основные узлы
        </label>
      </div>
    </div>
  </div>

    <!-- Модальное окно -->
<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-title">Заголовок</h2>
      <button class="close-btn close-modal">&times;</button>
    </div>

    <!-- Карусель изображений -->
    <div class="image-carousel">
      <div class="carousel-inner" id="carousel-inner"></div>
      <div class="carousel-control prev" onclick="moveCarousel(-1)">❮</div>
      <div class="carousel-control next" onclick="moveCarousel(1)">❯</div>
      <div class="carousel-indicators" id="carousel-indicators"></div>
    </div>

    <div class="item-content">
      <!-- Обновлённые дополнительные модальные окна -->
      <div class="additional-modals">
        <div class="additional-modal" onclick="showAdditionalModal(3)">
          <h3>Переменные</h3>
          <p id="modal-variables">Ключевые параметры</p>
        </div>
        
        <div class="additional-modal" onclick="showAdditionalModal(0)">
          <h3>Описание</h3>
          <p id="modal-description">Основное описание элемента</p>
        </div>

        <div class="additional-modal" onclick="showAdditionalModal(1)">
          <h3>История</h3>
          <p id="modal-history">Историческая справка</p>
        </div>
        
        <div class="additional-modal" onclick="showAdditionalModal(2)">
          <h3>Применение</h3>
          <p id="modal-applications">Практическое применение</p>
        </div>

        
      </div>
    </div>
  </div>
</div>

  <!-- Дополнительное модальное окно -->
  <div id="additional-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2 id="additional-modal-title">Дополнительная информация</h2>
        <button class="close-btn close-additional-modal">&times;</button>
      </div>
      <div class="item-content">
        <p class="content-text" id="additional-modal-content">Содержимое дополнительного модального окна</p>
      </div>
    </div>
  </div>

  
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    // Инициализация карты
    const map = L.map("map", {
      center: [7.5, 7.5],
      zoom: 4,
      minZoom: 2,
      maxZoom: 10,
      zoomControl: true,
      attributionControl: false
    });

    // Слои для разных типов элементов
    const layers = {
      zones: L.layerGroup(),
      zoneOutlines: L.layerGroup(),
      nodes: L.layerGroup(),
      nodeGlows: L.layerGroup(),
      subtopics: L.layerGroup(),
      connections: L.layerGroup(),
      labels: L.layerGroup()
    };

    // Добавляем все слои на карту
    Object.values(layers).forEach(layer => layer.addTo(map));

    // Цвета для категорий
    const categoryColors = {
      "Философия": "#6bc1ff",
      "Классическая физика": "#ff6b6b",
      "Квантовая физика": "#b96bff",
      "Теория относительности": "#6bff9a",
      "Будущее физики": "#ffd86b",
      "Пропасть незнания": "#1f3d2d"
    };

   const zones = [
    {
    name: "Пропасть незнания",
    color: "#1f3d2d",
    shape: [
        // Нижняя граница (соединение с Теорией относительности - изменено с ребристостью)
        [13.0, 0.0],
        [13.2, -0.15],  // Небольшая впадина
        [13.5, 0.05],   // Первый выступ
        [13.7, -0.1],   // Впадина
        [14.0, 0.2],    // Выступ
        [14.3, -0.05],  // Впадина
        [14.5, 0.15],   // Выступ
        [14.8, 0.0],    // Плавный переход
        [15.0, 0.25],   // Выступ
        [15.2, 0.1],    // Небольшая впадина
        [15.5, 0.4],    // Конечная точка соединения
        
        // Начало хаотичной ребристости (не затрагиваем соединения)
        [15.7, 0.45],  // Небольшой выступ
        [15.9, 0.6],
        [16.0, 0.8],
        [16.1, 0.95],  // Мини-пик
        [16.3, 1.05],
        [16.5, 1.2],
        [16.6, 1.05],  // Небольшой провал
        [16.8, 0.9],
        [17.0, 1.0],
        
        // Центральная хаотичная часть
        [17.0, 1.3],   // Ступенька
        [16.95, 1.55], // Легкий изгиб
        [17.0, 1.8],
        [16.92, 2.1],  // Выступ
        [16.98, 2.35],
        [17.0, 2.5],
        [16.88, 2.75], // Зубчик
        [16.95, 3.05],
        [17.0, 3.2],
        [16.85, 3.5],  // Глубокий провал
        [16.93, 3.7],
        [17.0, 3.8],
        [16.97, 3.95], // Мелкая неровность
        [17.0, 4.0],
        
        // Верхняя граница (соединение с Философией - ключевые точки сохранены!)
        [16.8, 4.3],   // Эта точка должна остаться точно такой же!
        [16.5, 4.6],   // И эта тоже!
        [16.5, 4.8],   // Добавляем неровность перед ключевой точкой
        [16.45, 4.95], // Небольшой выступ
        [16.5, 5.0],   // Ключевая точка соединения - не меняем!
        
        // Правый бок (соединение с Философией - не меняем)
        [16.0, 5.0],   // Важная точка соединения
        [15.5, 5.4],   // Важная точка соединения
        [15.3, 5.55],  // Добавляем небольшую неровность
        [15.0, 5.8],   // Важная точка соединения
        [14.8, 5.9],   // Небольшой выступ
        [14.5, 6.0],   // Важная точка соединения
        [14.3, 6.1],   // Мелкая неровность
        [14.0, 6.2],   // Важная точка соединения
        [13.8, 6.05],  // Зубчик
        [13.5, 5.8],   // Важная точка соединения
        [13.3, 5.65],  // Небольшой изгиб
        [13.0, 5.5],   // Важная точка соединения
        
        // Левая граница (полностью синхронизирована с Теорией относительности)
        [13.0, 4.8],    // Начальная точка соединения
        [12.97, 4.65],  [13.03, 4.5],    // Сопряженные выступы
        [12.98, 4.35],  [13.0, 4.0],     // Плавный переход
        [12.94, 3.88],  [13.06, 3.72],   // Глубокие компенсирующие выступы
        [13.0, 3.5],    [12.975, 3.38],  // Микровыступ
        [13.025, 3.22], [12.955, 3.08],  // Хаотичный участок
        [13.0, 2.5],    [12.945, 2.38],  // Резкий выступ
        [13.055, 2.18], [13.0, 2.0],     // Возврат к фиксированной точке
        [12.972, 1.86], [13.028, 1.64],  // Связанная пара
        [13.0, 1.0],    [12.982, 0.62],  // Предфинальный изгиб
        [13.018, 0.28], [13.0, 0.0]      // Точное соединение
    ]
},
    {
        name: "Классическая физика",
        color: "#ff6b6b",
        shape: [ 
            [5.5,5.5], [9.0,4.0], [11.0,5.5], [12.0,5.5], [13.0,5.5],
            [13.2,5.8], [13.0,6.1], [13.4,7.2], [12.9,8.3],
            [13.7,9.9], [13.0,10.5], [13.6,12.1], [13.0,13.0],
            [13.0,14.0], [12.0,14.0], [11.0,14.0], [10.0,13.5],
            [9.0,13.0], [8.0,13.5], [7.0,14.0], [6.0,13.0],
            [7.0,10.0], [6.2,9.0], [5.6,8.4], [5.6,7.0], [6.0,7.0], [7.0,5.5]
        ]
    },
   {
    name: "Будущее физики",
    color: "#ffd86b",
    shape: [
        // Неизмененная часть соединения с классической физикой
        [6.0, 13.0],
        [7.0, 14.0],
        [8.0, 13.5],
        [9.0, 13.0],
        [10.0, 13.5],
        [11.0, 14.0],
        [12.0, 14.0],
        [13.0, 14.0],
        
        // Точное соединение с философией (повторяем точки философии с небольшим смещением)
        [13.5, 14.5],
        [14.0, 15.0],
        [14.5, 15.2],
        [15.0, 15.5],
        [15.4, 15.8],
        [16.0, 16.0],
        [16.5, 15.8],
        [17.0, 15.0],
        
        // Правая граница (повторяем контур философии с небольшим смещением вправо)
        [17.1, 15.1],  // +0.1 по X для избежания наложения
        [17.1, 17.1],
        [16.8, 17.3],  // +0.1 по X
        [16.4, 17.5],  // +0.1 по X
        [16.0, 17.6],
        [15.9, 17.8],  // +0.1 по X
        [15.6, 18.0],  // +0.1 по X
        [15.1, 18.1],
        [14.8, 18.3],  // +0.1 по X
        [14.4, 18.5],  // +0.1 по X
        [14.0, 18.6],
        [13.9, 18.8],  // +0.1 по X
        [13.6, 19.0],  // +0.1 по X
        [13.1, 19.1],
        [12.8, 19.3],  // +0.1 по X
        [12.4, 19.5],  // +0.1 по X
        [12.0, 19.6],
        [11.9, 19.8],  // +0.1 по X
        [11.6, 20.0],  // +0.1 по X
        [11.1, 20.1],
        [10.8, 20.4],  // +0.1 по X
        [10.4, 20.5],  // +0.1 по X
        [10.0, 20.6],
        [9.8, 20.8],   // +0.1 по X
        [9.6, 21.0],   // +0.1 по X
        [9.1, 21.1],
        [8.8, 20.9],   // +0.1 по X
        [8.4, 20.7],   // +0.1 по X
        [8.0, 20.6],
        [7.8, 20.4],   // +0.1 по X
        [7.4, 20.2],   // +0.1 по X
        [7.0, 20.1],
        [6.8, 20.4],   // +0.1 по X
        [6.4, 20.5],   // +0.1 по X
        [6.0, 20.6],
        
        // Остальная часть без изменений
        [5.2, 20.2],
        [5.0, 19.8],
        [4.6, 19.9],
        [4.0, 19.4],
        [3.5, 19.7],
        [3.0, 19.2],
        [2.4, 19.5],
        [2.0, 19.0],
        [1.3, 19.3],
        [1.0, 18.8],
        [0.4, 19.1],
        [0.0, 18.6],
        [-0.5, 18.0],
        [-0.2, 17.2],
        [-0.7, 16.5],
        [0.1, 16.0],
        [-0.8, 15.5],
        [0.2, 15.3],
        [0.5, 15.0],
        [1.0, 15.2],
        [1.5, 15.4],
        [2.0, 15.6],
        [2.5, 15.8],
        [3.0, 16.0],
        [4.0, 15.5],
        [5.0, 15.0],
        [6.0, 14.5]
    ]
},
    {
        name: "Квантовая физика",
        color: "#b96bff",
        shape: [
            [4.0, 0.0],
            [3.5, -0.05],
            [3.0, 0.1],
            [2.5, -0.03],
            [2.0, 0.07],
            [1.5, -0.02],
            [1.0, 0.05],
            [0.5, -0.01],
            [0.0, 0.0],
            [-0.2, 0.5],
            [0.1, 1.0],
            [-0.3, 2.0],
            [0.2, 3.0],
            [-0.1, 4.0],
            [0.3, 5.0],
            [-0.2, 6.0],
            [0.1, 7.0],
            [-0.3, 8.0],
            [0.2, 9.0],
            [-0.1, 10.0],
            [0.3, 11.0],
            [-0.2, 12.0],
            [0.1, 13.0],
            [-0.3, 14.0],
            [0.2, 15.0],
            [0.5, 15.0],   // Новые точки для более плотного соединения
            [1.0, 15.2],
            [1.5, 15.4],
            [2.0, 15.6],
            [2.5, 15.8],
            [3.0, 16.0],
            [4.0, 15.5],
            [5.0, 15.0],
            [6.0, 14.5],
            [6.0, 13.0],
            [7.0, 10.0],
            [6.2, 9.0],
            [5.6, 8.4],
            [5.6, 7.0],
            [6.0, 7.0],
            [7.0, 5.5],
            [5.5, 5.5],
            [5.0, 4.0],
            [4.5, 2.0],
            [4.0, 1.0],
            [4.0, 0.0]
        ]
    },
    {
    name: "Философия",
    color: "#6bc1ff",
    shape: [
        // Соединение с Классической физикой
        [13.0, 5.5],
        [13.2, 5.8],
        [13.0, 6.1],
        [13.4, 7.2],
        [12.9, 8.3],
        [13.7, 9.9],
        [13.0, 10.5],
        [13.6, 12.1],
        [13.0, 13.0],
        [13.0, 14.0],

        // Плавное соединение с Будущим физики
        [13.5, 14.5],  // Добавлена промежуточная точка
        [14.0, 15.0],
        [14.5, 15.2],  // Новая ребристая точка
        [15.0, 15.5],
        [15.4, 15.8],  // Новая ребристая точка
        [16.0, 16.0],
        [16.5, 15.8],  // Новая ребристая точка
        
        // Ребристая правая граница
        [17.0, 15.0],
        [17.2, 14.5],  // Выступ вправо
        [17.0, 14.0],
        [17.3, 13.5],  // Выступ вправо
        [17.0, 13.0],
        [17.2, 12.5],  // Выступ вправо
        [17.0, 12.0],
        [17.3, 11.5],  // Выступ вправо
        [17.0, 11.0],
        [17.2, 10.5],  // Выступ вправо
        [17.0, 10.0],
        [17.3, 9.5],   // Выступ вправо
        [17.0, 9.0],
        [17.2, 8.5],   // Выступ вправо
        [17.0, 8.0],
        [17.3, 7.5],   // Выступ вправо
        [17.0, 7.0],
        [17.2, 6.5],   // Выступ вправо
        [17.0, 6.0],   // Начало соединения с Пропастью
        
        // Совпадение с нижней границей Пропасти незнания
        [16.8, 4.3],
        [16.5, 4.6],
        [16.5, 4.8],   // Добавлено для ребристости
        [16.45, 4.95], // Добавлено для ребристости
        [16.5, 5.0],
        [16.0, 5.0],
        [15.5, 5.4],
        [15.3, 5.55],  // Добавлено для ребристости
        [15.0, 5.8],
        [14.8, 5.9],   // Добавлено для ребристости
        [14.5, 6.0],
        [14.3, 6.1],   // Добавлено для ребристости
        [14.0, 6.2],
        [13.8, 6.05],  // Добавлено для ребристости
        [13.5, 5.8],
        [13.3, 5.65],  // Добавлено для ребристости
        [13.0, 5.5]
    ]
},
    {
    "name": "Теория относительности",
    "color": "#6bff9a",
    "shape": [
        // Левая часть (без изменений)
        [4.0, 1.0],
        [4.5, 2.0],
        [5.0, 4.0],
        [5.5, 5.5],
        
        // Верхние соединения (без изменений)
        [9.0, 4.0],
        [11.0, 5.5],
        [12.0, 5.5],
        [13.0, 5.5],
        [13.0, 5.0],
        [13.0, 4.8],
        [12.97, 4.65],
        [13.03, 4.5],
        [12.98, 4.35],
        [13.0, 4.0],
        [12.94, 3.88],
        [13.06, 3.72],
        [13.0, 3.5],
        [12.975, 3.38],
        [13.025, 3.22],
        [12.955, 3.08],
        [13.0, 2.5],
        [12.945, 2.38],
        [13.055, 2.18],
        [13.0, 2.0],
        [12.972, 1.86],
        [13.028, 1.64],
        [13.0, 1.0],
        [12.982, 0.62],
        [13.018, 0.28],
        
        // Модифицированная правая нижняя часть (вытянута вниз)
        [13.0, 0.0],    // Точка соединения с Квантовой физикой
        [12.5, -0.5],   // Новый глубокий выступ
        [12.0, -0.3],
        [11.5, -0.6],   // Максимальное углубление
        [11.0, -0.4],
        [10.5, -0.7],   // Еще одно углубление
        [10.0, -0.5],
        [9.5, -0.8],    // Самая нижняя точка
        [9.0, -0.6],
        [8.5, -0.4],
        [8.0, -0.2],
        [7.5, 0.0],
        [7.0, 0.1],
        [6.5, 0.0],
        [6.0, 0.2],
        [5.5, 0.0],
        [5.0, 0.3],
        [4.5, 0.1],
        [4.0, 0.4],     // Плавный подъем к начальной точке
        [4.0, 1.0]      // Замыкаем полигон
    ]
},
];
    // Добавляем зоны на карту
    zones.forEach(zone => {
      // Контур зоны
      L.polygon(zone.shape, {
        color: '#000',
        weight: 2,
        fillOpacity: 0,
        opacity: 1,
        className: 'outer-stroke'
      }).addTo(layers.zoneOutlines);

      // Заполнение зоны
      const polygon = L.polygon(zone.shape, {
        color: zone.color,
        fillColor: zone.color,
        fillOpacity: 0.3,
        weight: 1,
        opacity: 1
      }).addTo(layers.zones);

      // Подпись зоны
      const center = getPolygonCenter(zone.shape);
      const label = L.tooltip({
        permanent: true,
        direction: "center",
        className: "zone-label",
        content: zone.name
      }).setLatLng(center).addTo(layers.zones);

      // Инициализация прозрачности в зависимости от начального зума
      const initialZoom = map.getZoom();
      const minZoomForLabels = 4;
      label.getElement().style.opacity = Math.max(0, 1.0 - (initialZoom - minZoomForLabels) * 0.3);
      label.getElement().style.fontSize = `${Math.max(10, 13 - (initialZoom - minZoomForLabels) * 0.5)}px`;
    });

    // Основные узлы
    const mainNodes = [
      { id: "philosophy_core", lat: 15.0, lng: 10.0, name: 'Философия', category: "Философия" },
      { id: "classical_core", lat: 8.0, lng: 8.0, name: 'Классическая физика', category: "Классическая физика" },
      { id: "quantum_core", lat: 2.5, lng: 9.0, name: 'Квантовая физика', category: "Квантовая физика" },
      { id: "relativity_core", lat: 8.0, lng: 3.0, name: 'Теория относительности', category: "Теория относительности" },
      { id: "future_core", lat: 9.0, lng: 15.0, name: 'Будущее физики', category: "Будущее физики" },
      { id: "unknown_core", lat: 14.5, lng: 2.0, name: 'Пропасть незнания', category: "Пропасть незнания" },
    ];

    // Добавляем основные узлы
    mainNodes.forEach(node => {
      const color = categoryColors[node.category];
      
      // Свечение узла
      L.circleMarker([node.lat, node.lng], {
        radius: 15,
        fillColor: color,
        color: "transparent",
        weight: 0,
        fillOpacity: 0.1
      }).addTo(layers.nodeGlows);

      // Сам узел
      const marker = L.circleMarker([node.lat, node.lng], {
        radius: 8,
        fillColor: color,
        color: "#fff",
        weight: 1.5,
        opacity: 0.9,
        fillOpacity: 1
      }).addTo(layers.nodes);

      // Подсказка для узла
      marker.bindTooltip(node.name, {
        permanent: true,
        direction: 'top',
        className: 'node-tooltip',
        offset: [0, -10]
      });

      // Сохраняем ссылку на узел для создания связей
      node.marker = marker;
      
      // Обработчик клика для узла
      let lastClickTime = 0;
      marker.on('click', function(e) {
        const now = Date.now();
        if (now - lastClickTime < 30) { // Двойной клик (интервал 300ms)
          resetHighlight();
          lastClickTime = 0;
          return;
        }
        lastClickTime = now;
        
        highlightNode(node.id);
        showModal(node);
      });
    });

    // Все подтемы
    const allTopics = [
      // Философские основания (17)
      // Философские основания (17 точек)
{ id: "ontology", name: "Онтология", category: "Философия", parent: "philosophy_core", lat: 14.2, lng: 9.0 },
{ id: "epistemology", name: "Эпистемология", category: "Философия", parent: "philosophy_core", lat: 14.8, lng: 9.8 },
{ id: "metaphysics", name: "Метафизика", category: "Философия", parent: "philosophy_core", lat: 15.5, lng: 8.5 },
{ id: "objective_reality", name: "Объективная реальность", category: "Философия", parent: "philosophy_core", lat: 16.0, lng: 10.5 },
{ id: "dark_matter_ontology", name: "Онтология темной материи", category: "Философия", parent: "philosophy_core", lat: 14.0, lng: 10.5 },
{ id: "observer_role", name: "Роль наблюдателя", category: "Философия", parent: "philosophy_core", lat: 15.8, lng: 12.0 },
{ id: "scientific_method", name: "Научный метод", category: "Философия", parent: "philosophy_core", lat: 16.5, lng: 9.0 },
{ id: "time_metaphysics", name: "Метафизика времени", category: "Философия", parent: "philosophy_core", lat: 16.2, lng: 11.0 },
{ id: "anthropic_principle", name: "Антропный принцип", category: "Философия", parent: "philosophy_core", lat: 14.5, lng: 11.0 },
{ id: "quantum_philosophy", name: "Философия квантовой механики", category: "Философия", parent: "philosophy_core", lat: 15.0, lng: 12.0 },
{ id: "relativity_philosophy", name: "Философия относительности", category: "Философия", parent: "philosophy_core", lat: 16.8, lng: 8.0 },
{ id: "consciousness_philosophy", name: "Сознание и физика", category: "Философия", parent: "philosophy_core", lat: 16.0, lng: 13.0 },
{ id: "determinism", name: "Детерминизм", category: "Философия", parent: "philosophy_core", lat: 15.2, lng: 7.5 },
{ id: "field_nature", name: "Природа поля", category: "Философия", parent: "philosophy_core", lat: 16.5, lng: 10.0 },
{ id: "reality_nature", name: "Природа реальности", category: "Философия", parent: "philosophy_core", lat: 15.7, lng: 9.0 },
{ id: "mathematical_methods", name: "Математические методы", category: "Философия", parent: "philosophy_core", lat: 14.5, lng: 8.0 },
{ id: "least_action", name: "Принцип наименьшего действия", category: "Философия", parent: "philosophy_core", lat: 14.8, lng: 8.5 },
{ id: "ether_theories", name: "Эфирные теории", category: "Философия", parent: "philosophy_core", lat: 15.3, lng: 9.2 },
{ id: "probability_interpretations", name: "Интерпретации вероятности", category: "Философия", parent: "philosophy_core", lat: 15.6, lng: 10.8 },
{ id: "copenhagen", name: "Копенгагенская интерпретация", category: "Философия", parent: "philosophy_core", lat: 15.9, lng: 11.5 },
      // Классическая физика - Механика (левый нижний сектор)
{ id: "mechanics", name: "Механика", category: "Классическая физика", parent: "classical_core", lat: 6.8, lng: 6.8 },
{ id: "kinematics", name: "Кинематика", category: "Классическая физика", parent: "mechanics", lat: 6.5, lng: 6.5 },
{ id: "kinematics_motion", name: "Движение точки", category: "Классическая физика", parent: "kinematics", lat: 6.4, lng: 6.4 },
{ id: "kinematics_rotation", name: "Вращательное движение", category: "Классическая физика", parent: "kinematics", lat: 6.6, lng: 6.4 },
{ id: "kinematics_relativity", name: "Относительность движения", category: "Классическая физика", parent: "kinematics", lat: 6.4, lng: 6.6 },
{ id: "uniform_motion", name: "Равномерное движение", category: "Классическая физика", parent: "kinematics", lat: 6.5, lng: 6.6 },
{ id: "accel_motion", name: "Равноускоренное движение", category: "Классическая физика", parent: "kinematics", lat: 6.6, lng: 6.5 },
{ id: "free_fall", name: "Свободное падение", category: "Классическая физика", parent: "kinematics", lat: 6.3, lng: 6.5 },

// Динамика
{ id: "dynamics", name: "Динамика", category: "Классическая физика", parent: "mechanics", lat: 7.2, lng: 7.2 },
{ id: "newton_laws", name: "Законы Ньютона", category: "Классическая физика", parent: "dynamics", lat: 7.3, lng: 7.3 },
{ id: "forces", name: "Силы в природе", category: "Классическая физика", parent: "dynamics", lat: 7.1, lng: 7.3 },
{ id: "complex_forces", name: "Движение под действием сил", category: "Классическая физика", parent: "dynamics", lat: 7.3, lng: 7.1 },
{ id: "friction_forces", name: "Силы трения", category: "Классическая физика", parent: "dynamics", lat: 7.2, lng: 7.2 },
{ id: "lever_principle", name: "Принцип рычага", category: "Классическая физика", parent: "dynamics", lat: 7.1, lng: 7.4 },

// Законы сохранения
{ id: "conservation", name: "Законы сохранения", category: "Классическая физика", parent: "mechanics", lat: 6.8, lng: 7.8 },
{ id: "energy", name: "Энергия", category: "Классическая физика", parent: "conservation", lat: 6.9, lng: 7.9 },
{ id: "momentum", name: "Импульс", category: "Классическая физика", parent: "conservation", lat: 6.7, lng: 7.8 },
{ id: "angular_momentum", name: "Момент импульса", category: "Классическая физика", parent: "conservation", lat: 6.9, lng: 8.0 },

// Колебания и волны
{ id: "oscillations", name: "Колебания и волны", category: "Классическая физика", parent: "mechanics", lat: 8.2, lng: 6.5 },
{ id: "harmonic", name: "Гармонические колебания", category: "Классическая физика", parent: "oscillations", lat: 8.3, lng: 6.6 },
{ id: "damped", name: "Затухающие колебания", category: "Классическая физика", parent: "oscillations", lat: 8.1, lng: 6.6 },
{ id: "mech_waves", name: "Механические волны", category: "Классическая физика", parent: "oscillations", lat: 8.2, lng: 6.3 },

// Статика
{ id: "statics", name: "Статика", category: "Классическая физика", parent: "mechanics", lat: 6.5, lng: 8.5 },
{ id: "equilibrium", name: "Условия равновесия", category: "Классическая физика", parent: "statics", lat: 6.6, lng: 8.6 },
{ id: "pressure", name: "Давление", category: "Классическая физика", parent: "statics", lat: 6.4, lng: 8.5 },
{ id: "archimedes", name: "Закон Архимеда", category: "Классическая физика", parent: "statics", lat: 6.5, lng: 8.4 },
{ id: "liquid_pressure", name: "Давление столба жидкости", category: "Классическая физика", parent: "statics", lat: 6.5, lng: 8.7 },

// Термодинамика (правый верхний сектор)
{ id: "thermodynamics", name: "Термодинамика", category: "Классическая физика", parent: "classical_core", lat: 11.5, lng: 11.5 },
{ id: "thermo_laws", name: "Законы термодинамики", category: "Классическая физика", parent: "thermodynamics", lat: 11.6, lng: 11.6 },
{ id: "entropy", name: "Энтропия", category: "Классическая физика", parent: "thermodynamics", lat: 11.4, lng: 11.6 },
{ id: "heat_machines", name: "Тепловые машины", category: "Классическая физика", parent: "thermodynamics", lat: 11.6, lng: 11.4 },

// МКТ
{ id: "mkt", name: "МКТ", category: "Классическая физика", parent: "thermodynamics", lat: 11.0, lng: 12.0 },
{ id: "ideal_gas", name: "Идеальный газ", category: "Классическая физика", parent: "mkt", lat: 11.1, lng: 12.1 },
{ id: "maxwell", name: "Распределение Максвелла", category: "Классическая физика", parent: "mkt", lat: 10.9, lng: 12.0 },
{ id: "transport", name: "Явления переноса", category: "Классическая физика", parent: "mkt", lat: 11.1, lng: 11.9 },

// Электромагнетизм (центральный правый сектор)
{ id: "electromagnetism", name: "Электромагнетизм", category: "Классическая физика", parent: "classical_core", lat: 12.5, lng: 8.5 },
{ id: "electrostatics", name: "Электростатика", category: "Классическая физика", parent: "electromagnetism", lat: 12.6, lng: 8.6 },
{ id: "current", name: "Электрический ток", category: "Классическая физика", parent: "electromagnetism", lat: 12.4, lng: 8.4 },
{ id: "magnetism", name: "Магнетизм", category: "Классическая физика", parent: "electromagnetism", lat: 12.6, lng: 8.4 },
{ id: "maxwell_eq", name: "Уравнения Максвелла", category: "Классическая физика", parent: "electromagnetism", lat: 12.5, lng: 8.6 },
{ id: "em_flux_density", name: "Плотность потока ЭМ излучения", category: "Классическая физика", parent: "electromagnetism", lat: 12.4, lng: 8.3 },

// Оптика (нижний правый выступ)
{ id: "optics", name: "Оптика", category: "Классическая физика", parent: "classical_core", lat: 12.5, lng: 6.5 },
{ id: "geo_optics", name: "Геометрическая оптика", category: "Классическая физика", parent: "optics", lat: 12.6, lng: 6.6 },
{ id: "wave_optics", name: "Волновая оптика", category: "Классическая физика", parent: "optics", lat: 12.4, lng: 6.6 },
{ id: "photometry", name: "Фотометрия", category: "Классическая физика", parent: "optics", lat: 12.5, lng: 6.4 },

// Дополнительные разделы
// Аналитическая механика
{ id: "analytical_mech", name: "Аналитическая механика", category: "Классическая физика", parent: "classical_core", lat: 5.8, lng: 7.8 },
{ id: "lagrange", name: "Метод Лагранжа", category: "Классическая физика", parent: "analytical_mech", lat: 5.9, lng: 7.9 },
{ id: "hamilton", name: "Метод Гамильтона", category: "Классическая физика", parent: "analytical_mech", lat: 5.7, lng: 7.9 },
{ id: "celestial", name: "Небесная механика", category: "Классическая физика", parent: "analytical_mech", lat: 5.8, lng: 7.7 },

// Специальные разделы
{ id: "phase_transitions", name: "Фазовые переходы", category: "Классическая физика", parent: "classical_core", lat: 9.0, lng: 12.5 },
{ id: "nuclear_physics", name: "Ядерная физика", category: "Классическая физика", parent: "classical_core", lat: 9.1, lng: 12.6 },
{ id: "statistical_physics", name: "Статистическая физика", category: "Классическая физика", parent: "classical_core", lat: 8.9, lng: 12.4 },
{ id: "condensed_matter", name: "Физика конденсированных сред", category: "Классическая физика", parent: "classical_core", lat: 9.1, lng: 12.7 },

      // Квантовая физика (29)
      // Квантовая физика (29 точек с новыми координатами)
{ id: "quantum_basics", name: "Основы квантовой физики", category: "Квантовая физика", parent: "quantum_core", lat: 2.0, lng: 8.5 },
{ id: "wave_particle", name: "Корпускулярно-волновой дуализм", category: "Квантовая физика", parent: "quantum_basics", lat: 1.8, lng: 8.0 },
{ id: "schrodinger", name: "Уравнение Шрёдингера", category: "Квантовая физика", parent: "quantum_basics", lat: 2.2, lng: 9.0 },
{ id: "uncertainty", name: "Принцип неопределённости", category: "Квантовая физика", parent: "quantum_basics", lat: 2.5, lng: 8.0 },
{ id: "wave_function", name: "Волновая функция", category: "Квантовая физика", parent: "quantum_basics", lat: 1.5, lng: 8.8 },
{ id: "hilbert_space", name: "Гильбертово пространство", category: "Квантовая физика", parent: "quantum_basics", lat: 3.0, lng: 8.2 },
{ id: "atomic_physics", name: "Атомная физика", category: "Квантовая физика", parent: "quantum_core", lat: 1.0, lng: 10.0 },
{ id: "bohr_model", name: "Модель Бора", category: "Квантовая физика", parent: "atomic_physics", lat: 0.8, lng: 10.5 },
{ id: "quantum_numbers", name: "Квантовые числа", category: "Квантовая физика", parent: "atomic_physics", lat: 1.2, lng: 9.8 },
{ id: "electron_spin", name: "Спин электрона", category: "Квантовая физика", parent: "atomic_physics", lat: 0.5, lng: 11.0 },
{ id: "pauli", name: "Принцип Паули", category: "Квантовая физика", parent: "atomic_physics", lat: 1.5, lng: 10.8 },
{ id: "quantum_effects", name: "Квантовые эффекты", category: "Квантовая физика", parent: "quantum_core", lat: 3.5, lng: 7.5 },
{ id: "tunneling", name: "Туннелирование", category: "Квантовая физика", parent: "quantum_effects", lat: 3.8, lng: 7.0 },
{ id: "entanglement", name: "Запутанность", category: "Квантовая физика", parent: "quantum_effects", lat: 3.2, lng: 8.0 },
{ id: "superposition", name: "Суперпозиция", category: "Квантовая физика", parent: "quantum_effects", lat: 3.0, lng: 7.2 },
{ id: "aharonov_bohm", name: "Эффект Ааронова-Бома", category: "Квантовая физика", parent: "quantum_effects", lat: 3.7, lng: 7.8 },
{ id: "qft", name: "Квантовая теория поля", category: "Квантовая физика", parent: "quantum_core", lat: 4.0, lng: 10.0 },
{ id: "qed", name: "Квантовая электродинамика", category: "Квантовая физика", parent: "qft", lat: 4.5, lng: 9.5 },
{ id: "qcd", name: "Квантовая хромодинамика", category: "Квантовая физика", parent: "qft", lat: 3.8, lng: 10.8 },
{ id: "standard_model", name: "Стандартная модель", category: "Квантовая физика", parent: "qft", lat: 4.2, lng: 11.2 },
{ id: "higgs", name: "Бозон Хиггса", category: "Квантовая физика", parent: "qft", lat: 4.8, lng: 10.2 },
{ id: "quantum_apps", name: "Приложения квантовой физики", category: "Квантовая физика", parent: "quantum_core", lat: 2.0, lng: 11.5 },
{ id: "quantum_computing", name: "Квантовые вычисления", category: "Квантовая физика", parent: "quantum_apps", lat: 1.5, lng: 12.0 },
{ id: "quantum_crypto", name: "Квантовая криптография", category: "Квантовая физика", parent: "quantum_apps", lat: 2.5, lng: 11.0 },
{ id: "quantum_sensors", name: "Квантовые сенсоры", category: "Квантовая физика", parent: "quantum_apps", lat: 2.2, lng: 12.2 },
{ id: "dirac_equation", name: "Уравнение Дирака", category: "Квантовая физика", parent: "quantum_basics", lat: 1.0, lng: 7.5 },
{ id: "quantum_thermo", name: "Квантовая термодинамика", category: "Квантовая физика", parent: "quantum_apps", lat: 1.8, lng: 11.8 },
{ id: "quantum_optics", name: "Квантовая оптика", category: "Квантовая физика", parent: "quantum_apps", lat: 2.8, lng: 12.5 },
{ id: "particle_physics", name: "Физика частиц", category: "Квантовая физика", parent: "quantum_core", lat: 0.2, lng: 9.5 },
{ id: "quantum_coherence", name: "Квантовая когерентность", category: "Квантовая физика", parent: "quantum_effects", lat: 3.5, lng: 6.8 },
{ id: "quantum_chaos", name: "Квантовый хаос", category: "Квантовая физика", parent: "quantum_effects", lat: 3.2, lng: 6.5 },
      // Теория относительности (16)
      // Теория относительности (17 точек)
{ id: "special", name: "Специальная теория относительности", category: "Теория относительности", parent: "relativity_core", lat: 7.0, lng: 2.5 },
{ id: "postulates", name: "Постулаты Эйнштейна", category: "Теория относительности", parent: "special", lat: 6.5, lng: 2.0 },
{ id: "lorenz", name: "Преобразования Лоренца", category: "Teория относительности", parent: "special", lat: 7.5, lng: 3.0 },
{ id: "effects", name: "Релятивистские эффекты", category: "Теория относительности", parent: "special", lat: 6.8, lng: 1.5 },
{ id: "dilation", name: "Замедление времени", category: "Теория относительности", parent: "effects", lat: 6.0, lng: 1.0 },
{ id: "length_contraction", name: "Сокращение длины", category: "Теория относительности", parent: "effects", lat: 7.1, lng: 1.5 },
{ id: "energy_momentum", name: "Релятивистская энергия-импульс", category: "Теория относительности", parent: "special", lat: 8.5, lng: 2.0 },
{ id: "general", name: "Общая теория относительности", category: "Теория относительности", parent: "relativity_core", lat: 9.0, lng: 3.5 },
{ id: "equivalence", name: "Принцип эквивалентности", category: "Теория относительности", parent: "general", lat: 8.0, lng: 4.0 },
{ id: "einstein_eq", name: "Уравнения Эйнштейна", category: "Теория относительности", parent: "general", lat: 9.5, lng: 3.0 },
{ id: "black_holes", name: "Чёрные дыры", category: "Теория относительности", parent: "general", lat: 10.0, lng: 1.0 },
{ id: "grav_waves", name: "Гравитационные волны", category: "Теория относительности", parent: "general", lat: 9.8, lng: 2.5 },
{ id: "cosmology", name: "Космология", category: "Теория относительности", parent: "relativity_core", lat: 11.0, lng: 3.5 },
{ id: "dark_matter", name: "Тёмная материя", category: "Теория относительности", parent: "cosmology", lat: 11.5, lng: 4.0 },
{ id: "dark_energy", name: "Тёмная энергия", category: "Теория относительности", parent: "cosmology", lat: 10.5, lng: 5.0 },
{ id: "universe_evolution", name: "Эволюция Вселенной", category: "Теория относительности", parent: "cosmology", lat: 12.0, lng: 5.0 },
{ id: "cosmic_rays", name: "Космические лучи", category: "Теория относительности", parent: "cosmology", lat: 11.8, lng: 3.8 },
{ id: "gps_systems", name: "GPS-системы", category: "Теория относительности", parent: "effects", lat: 7.1, lng: 1.0 },

     // Основной узел (центр зоны)
// Квантовые технологии (кластер вокруг 8.0, 14.5)
{ id: "quantum_tech", name: "Квантовые технологии", parent: "future_core", lat: 8.0, lng: 14.5 },
{ id: "quantum_information", name: "Квантовая информация", parent: "quantum_tech", lat: 7.8, lng: 14.3 },
{ id: "quantum_simulators", name: "Квантовые симуляторы", parent: "quantum_tech", lat: 8.2, lng: 14.7 },

// Теоретическая физика (кластер справа от центра)
{ id: "quantum_gravity", name: "Квантовая гравитация", parent: "future_core", lat: 10.0, lng: 16.0 },
{ id: "string_theory", name: "Теория струн", parent: "quantum_gravity", lat: 10.5, lng: 16.5 },
{ id: "loop_gravity", name: "Петлевая квантовая гравитация", parent: "quantum_gravity", lat: 9.5, lng: 16.5 },
{ id: "beyond_standard", name: "Физика за пределами Стандартной модели", parent: "future_core", lat: 10.2, lng: 15.5 },
{ id: "neutrino", name: "Физика нейтрино", parent: "beyond_standard", lat: 10.7, lng: 15.8 },
{ id: "multiverse", name: "Мультивселенная", parent: "future_core", lat: 11.0, lng: 16.2 },

// Прикладные технологии (нижний кластер)
{ id: "medical_physics", name: "Медицинская физика", parent: "future_core", lat: 9.0, lng: 13.5 },
{ id: "mri_technology", name: "МРТ-технологии", parent: "medical_physics", lat: 9.2, lng: 13.3 },
{ id: "neurophysics", name: "Нейрофизика", parent: "future_core", lat: 10.0, lng: 13.8 },
{ id: "tech_control", name: "Контроль технологий", parent: "future_core", lat: 8.5, lng: 13.6 },
{ id: "solar_cells", name: "Солнечные батареи", parent: "tech_control", lat: 8.7, lng: 13.3 },

// Энергетика (левый кластер)
{ id: "fusion", name: "Термоядерный синтез", parent: "future_core", lat: 7.0, lng: 15.0 },
{ id: "superconductivity", name: "Сверхпроводимость", parent: "future_core", lat: 6.5, lng: 14.5 },
{ id: "semiconductors", name: "Полупроводники", parent: "future_core", lat: 7.5, lng: 14.0 },

// Космические исследования (верхний кластер)
{ id: "neutron_stars", name: "Нейтронные звезды", parent: "future_core", lat: 7.0, lng: 16.5 },
{ id: "particle_accelerators", name: "Ускорители частиц", parent: "future_core", lat: 8.0, lng: 15.8 },
{ id: "accelerators", name: "Ускорители нового поколения", parent: "future_core", lat: 8.5, lng: 15.5 },

// Междисциплинарные исследования
{ id: "quantum_biology", name: "Квантовая биология", parent: "future_core", lat: 9.5, lng: 16.0 },
{ id: "photosynthesis", name: "Квантовые эффекты в фотосинтезе", parent: "quantum_biology", lat: 9.8, lng: 16.3 },
{ id: "magnetic_sense", name: "Магнитное чувство птиц", parent: "quantum_biology", lat: 9.2, lng: 16.3 },
{ id: "ai_physics", name: "Искусственный интеллект в физике", parent: "future_core", lat: 10.0, lng: 14.0 },
{ id: "chaos_theory", name: "Теория хаоса", parent: "future_core", lat: 6.0, lng: 15.5 },
{ id: "scientific_status", name: "Статус науки", parent: "future_core", lat: 8.0, lng: 13.7 },

      // Пропасть незнания (11)
{ id: "measurement_problem", name: "Проблема измерения", category: "Пропасть незнания", parent: "unknown_core", lat: 13.5, lng: 2.8 },
{ id: "time_nature", name: "Природа времени", category: "Пропасть незнания", parent: "unknown_core", lat: 13.8, lng: 3.2 },
{ id: "consciousness", name: "Сознание и квантовая механика", category: "Пропасть незнания", parent: "unknown_core", lat: 13.6, lng: 2.5 },
{ id: "hierarchy", name: "Проблема иерархии", category: "Пропасть незнания", parent: "unknown_core", lat: 13.5, lng: 3.5 },
{ id: "anthropic", name: "Антропный принцип", category: "Пропасть незнания", parent: "unknown_core", lat: 14.0, lng: 2.8 },
{ id: "time_arrow", name: "Стрела времени", category: "Пропасть незнания", parent: "unknown_core", lat: 14.5, lng: 3.0 },
{ id: "wave_collapse", name: "Коллапс волновой функции", category: "Пропасть незнания", parent: "unknown_core", lat: 15.0, lng: 2.5 },
{ id: "spacetime_discrete", name: "Дискретность пространства-времени", category: "Пропасть незнания", parent: "unknown_core", lat: 15.5, lng: 3.2 },
{ id: "local_realism", name: "Локальный реализм", category: "Пропасть незнания", parent: "unknown_core", lat: 16.0, lng: 2.8 },
{ id: "crisis_cosmology", name: "Кризис в космологии", category: "Пропасть незнания", parent: "unknown_core", lat: 16.5, lng: 3.0 },
{ id: "quantum_mind", name: "Квантовый мозг", category: "Пропасть незнания", parent: "consciousness", lat: 13.8, lng: 2.0 },


      // Новые подтемы
      
      { id: "hydrodynamics", name: "Гидродинамика", category: "Классическая физика", parent: "mechanics", lat: 7.7, lng: 8.3 },
      { id: "navier_stokes", name: "Уравнения Навье-Стокса", category: "Классическая физика", parent: "hydrodynamics", lat: 7.6, lng: 8.4 },
      { id: "quantum_fluids", name: "Квантовые жидкости", category: "Квантовая физика", parent: "condensed_matter", lat: 5.3, lng: 8.5 },
      { id: "quantum_algorithms", name: "Квантовые алгоритмы", category: "Квантовая физика", parent: "quantum_computing", lat: 5.8, lng: 8.7 },
      { id: "topological_insulators", name: "Топологические изоляторы", category: "Квантовая физика", parent: "condensed_matter", lat: 5.4, lng: 8.6 },
      { id: "holographic_principle", name: "Голографический принцип", category: "Теория относительности", parent: "quantum_gravity", lat: 5.2, lng: 3.2 },
     
      
      { id: "archaeophysics", name: "Археофизика", category: "Классическая физика", parent: "nuclear_physics", lat: 8.15, lng: 8.85 },
      
      
      
      { id: "feynman_path", name: "Интегралы по траекториям (Фейнман)", category: "Квантовая физика", parent: "quantum_basics", lat: 5.1, lng: 8.0 },
      

      { id: "wave_characteristics", name: "Характеристики волн", category: "Классическая физика", parent: "oscillations", lat: 7.5, lng: 5.2 },
{ id: "amplitude", name: "Амплитуда", category: "Классическая физика", parent: "wave_characteristics", lat: 8.0, lng: 7.4 },
{ id: "wavelength", name: "Длина волны", category: "Классическая физика", parent: "wave_characteristics", lat: 8.2, lng: 7.4 },
{ id: "phase_velocity", name: "Фазовая скорость", category: "Классическая физика", parent: "wave_characteristics", lat: 8.1, lng: 7.2 },
{ id: "surface_tension", name: "Коэффициент поверхностного натяжения", category: "Классическая физика", parent: "wave_characteristics", lat: 8.05, lng: 7.5 },
{ id: "pendulum_types", name: "Типы маятников", category: "Классическая физика", parent: "harmonic", lat: 8.6, lng: 7.1 },
{ id: "math_pendulum", name: "Математический маятник", category: "Классическая физика", parent: "pendulum_types", lat: 8.5, lng: 7.0 },
{ id: "phys_pendulum", name: "Физический маятник", category: "Классическая физика", parent: "pendulum_types", lat: 8.7, lng: 7.0 },
{ id: "torsion_pendulum", name: "Крутильный маятник", category: "Классическая физика", parent: "pendulum_types", lat: 8.8, lng: 7.2 },
{ id: "spring_pendulum", name: "Пружинный маятник", category: "Классическая физика", parent: "pendulum_types", lat: 8.6, lng: 6.9 },

{ id: "oscillation_params", name: "Характеристики колебаний", category: "Классическая физика", parent: "harmonic", lat: 8.4, lng: 7.3 },
{ id: "oscillation_period", name: "Период колебаний", category: "Классическая физика", parent: "oscillation_params", lat: 8.3, lng: 7.4 },
{ id: "angular_frequency", name: "Циклическая частота", category: "Классическая физика", parent: "oscillation_params", lat: 8.5, lng: 7.4 },
{ id: "frequency", name: "Частота колебаний", category: "Классическая физика", parent: "oscillation_params", lat: 8.3, lng: 7.2 },
{ id: "em_oscillations", name: "Электромагнитные колебания", category: "Классическая физика", parent: "electromagnetism", lat: 7.4, lng: 8.4 },
{ id: "em_period", name: "Период электромагнитных колебаний", category: "Классическая физика", parent: "em_oscillations", lat: 7.3, lng: 8.5 },
{ id: "resonance_frequency", name: "Частота резонанса колебательного контура", category: "Классическая физика", parent: "em_oscillations", lat: 7.5, lng: 8.5 },

{ id: "wave_speeds", name: "Скорости распространения", category: "Классическая физика", parent: "mech_waves", lat: 7.85, lng: 8.0 },
{ id: "sound_speed_gas", name: "Скорость звука в газах", category: "Классическая физика", parent: "wave_speeds", lat: 7.8, lng: 8.1 },
{ id: "electricity_speed", name: "Скорость распространения электричества", category: "Классическая физика", parent: "wave_speeds", lat: 8.0, lng: 8.3 },
{ id: "em_wave_speed", name: "Скорость ЭМ волн в веществе", category: "Классическая физика", parent: "wave_speeds", lat: 7.83, lng: 7.9 },
{ id: "phase_wave_speed", name: "Фазовая скорость волны", category: "Классическая физика", parent: "wave_speeds", lat: 7.92, lng: 8.2 },

{ id: "wave_effects", name: "Эффекты волновых процессов", category: "Классическая физика", parent: "mech_waves", lat: 8.2, lng: 7.8 },
{ id: "doppler_effect", name: "Эффект Доплера", category: "Классическая физика", parent: "wave_effects", lat: 8.0, lng: 7.9 },
{ id: "pause_law", name: "Закон паузы", category: "Классическая физика", parent: "wave_effects", lat: 8.3, lng: 7.9 },

{ id: "wave_relations", name: "Взаимосвязь параметров волн", category: "Классическая физика", parent: "mech_waves", lat: 8.0, lng: 7.7 },
{ id: "period_frequency", name: "Связь периода и частоты", category: "Классическая физика", parent: "wave_relations", lat: 7.9, lng: 7.8 },
{ id: "wave_speed_relation", name: "Скорость волны и её параметры", category: "Классическая физика", parent: "wave_relations", lat: 8.15, lng: 7.8 },
{ id: "medium_properties", name: "Влияние свойств среды", category: "Классическая физика", parent: "wave_relations", lat: 7.95, lng: 7.6 },

// Основные характеристики света (группируем вокруг maxwell)
{ id: "light_characteristics", name: "Основные характеристики света", category: "Классическая физика", parent: "optics", lat: 9.4, lng: 10.5 },

// Физические параметры (радиально вокруг light_characteristics)
{ id: "wavelength_visible", name: "Длина волны видимого света", category: "Классическая физика", parent: "light_characteristics", lat: 9.35, lng: 8.3 },
{ id: "wave_number", name: "Волновое число (k=2π/λ)", category: "Классическая физика", parent: "light_characteristics", lat: 9.5, lng: 8.3 },
{ id: "light_intensity", name: "Интенсивность света", category: "Классическая физика", parent: "light_characteristics", lat: 9.4, lng: 8.2 },
{ id: "refractive_index", name: "Показатель преломления", category: "Классическая физика", parent: "light_characteristics", lat: 9.3, lng: 8.5 },
{ id: "photometric_quantities", name: "Фотометрические величины", category: "Классическая физика", parent: "light_characteristics", lat: 12.5, lng: 6.4 },

// Характеристики источников света (выше maxwell)
{ id: "light_sources", name: "Характеристики источников света", category: "Классическая физика", parent: "optics", lat: 10.55, lng: 8.3 },
{ id: "luminous_intensity", name: "Сила света", category: "Классическая физика", parent: "light_sources", lat: 10.55, lng: 8.3 },
{ id: "luminosity", name: "Светимость", category: "Классическая физика", parent: "light_sources", lat: 10.55, lng: 8.3 },
{ id: "brightness", name: "Яркость", category: "Классическая физика", parent: "light_sources", lat: 10.55, lng: 8.3 },
{ id: "illuminance", name: "Освещённость", category: "Классическая физика", parent: "light_sources",  lat: 10.55, lng: 8.3 },
{ id: "lens_characteristics", name: "Характеристики линз", category: "Классическая физика", parent: "light_sources", lat: 10.55, lng: 8.3 },

// Оптические параметры (левее maxwell)
{ id: "optical_params", name: "Оптические параметры", category: "Классическая физика", parent: "optics", lat: 12.3, lng: 6.6 },
{ id: "focal_length", name: "Фокусное расстояние", category: "Классическая физика", parent: "optical_params", lat: 9.1, lng: 8.0 },
{ id: "optical_power", name: "Оптическая сила (D=1/F)", category: "Классическая физика", parent: "optical_params", lat: 12.35, lng: 6.65 },
{ id: "angular_characteristics", name: "Угловые характеристики", category: "Классическая физика", parent: "optical_params", lat: 12.28, lng: 6.63 },

// Пространственные параметры (ниже optical_params)
{ id: "spatial_params", name: "Пространственные параметры", category: "Классическая физика", parent: "optics", lat: 9.0, lng: 8.3 },
{ id: "solid_angle", name: "Телесный угол", category: "Классическая физика", parent: "spatial_params", lat: 8.9, lng: 8.2 },

// Законы и формулы (правее maxwell)
{ id: "light_laws", name: "Законы и формулы света", category: "Классическая физика", parent: "optics", lat: 9.46, lng: 8.6 },
{ id: "malus_law", name: "Закон Малюса", category: "Классическая физика", parent: "light_laws", lat: 9.2, lng: 8.66 },
{ id: "wien_law", name: "Закон смещения Вина", category: "Классическая физика", parent: "light_laws", lat: 9.7, lng: 8.6 },
{ id: "rayleigh_jeans", name: "Формула Рэлея-Джинса", category: "Классическая физика", parent: "light_laws", lat: 9.4, lng: 8.7 },

// Взаимосвязь параметров (между maxwell и optics)
{ id: "light_relations", name: "Взаимосвязь параметров света", category: "Классическая физика", parent: "optics", lat: 9.05, lng: 8.5 },
{ id: "intensity_angle", name: "Связь силы света и телесного угла", category: "Классическая физика", parent: "light_relations", lat: 8.95, lng: 8.4 },
{ id: "illuminance_intensity", name: "Зависимость освещённости от силы света", category: "Классическая физика", parent: "light_relations", lat: 9.2, lng: 8.4 },
{ id: "brightness_luminosity", name: "Взаимосвязь яркости и светимости", category: "Классическая физика", parent: "light_relations", lat: 9.1, lng: 8.6 },
// Ядерная физика (дополнения к существующей точке nuclear_physics)
{ id: "nuclear_characteristics", name: "Ядерные характеристики", category: "Классическая физика", parent: "nuclear_physics", lat: 8.95, lng: 8.7 },
{ id: "gyromagnetic_ratio", name: "Ядерное гидромагнитное отношение", category: "Классическая физика", parent: "nuclear_characteristics", lat: 8.85, lng: 8.5 },
{ id: "nuclear_magnetic_moment", name: "Магнитный момент ядра", category: "Классическая физика", parent: "nuclear_characteristics", lat: 9.0, lng: 8.56 },

// Диффузионные явления (связь с существующей точкой transport)
{ id: "diffusion_phenomena", name: "Диффузионные явления", category: "Классическая физика", parent: "transport", lat: 8.7, lng: 8.8 },
{ id: "diffusion_equation", name: "Уравнение диффузии", category: "Классическая физика", parent: "diffusion_phenomena", lat: 8.6, lng: 8.7 },

// Взаимосвязь параметров
{ id: "nuclear_relations", name: "Взаимосвязь ядерных параметров", category: "Классическая физика", parent: "nuclear_physics", lat: 8.9, lng: 8.8 },
{ id: "moment_ratio_relation", name: "Связь магнитного момента и гидромагнитного отношения", category: "Классическая физика", parent: "nuclear_relations", lat: 8.8, lng: 9.09 },
{ id: "diffusion_applications", name: "Применение уравнения диффузии", category: "Классическая физика", parent: "nuclear_relations", lat: 9.0, lng: 8.9 },
 // В раздел "Электромагнетизм" (parent: "electromagnetism")
{ id: "electric_charge", name: "Электрический заряд и его свойства", category: "Классическая физика", parent: "electromagnetism", lat: 12.5, lng: 8.9 },
{ id: "electric_fields", name: "Электрические поля", category: "Классическая физика", parent: "electromagnetism", lat: 12.55, lng: 8.55 },
{ id: "circuit_laws", name: "Законы электрических цепей", category: "Классическая физика", parent: "electromagnetism", lat: 9.0, lng: 7.8 },
{ id: "current_interaction", name: "Взаимодействие токов", category: "Классическая физика", parent: "electromagnetism", lat: 9.2, lng: 7.5 },
{ id: "capacitance", name: "Ёмкость конденсатора", category: "Классическая физика", parent: "electromagnetism", lat: 9.4, lng: 7.7 },

// Подтемы для законов
{ id: "biot_savart", name: "Закон Био-Савара-Лапласа", category: "Классическая физика", parent: "magnetism", lat: 9.5, lng: 7.3 },
{ id: "ohm_law", name: "Закон Ома", category: "Классическая физика", parent: "current", lat: 8.9, lng: 7.9 },
{ id: "faraday_law", name: "Закон Фарадея", category: "Классическая физика", parent: "magnetism", lat: 9.6, lng: 7.4 },
{ id: "kirchhoff_laws", name: "Законы Кирхгофа", category: "Классическая физика", parent: "current", lat: 8.8, lng: 7.7 },
{ id: "lorentz_force", name: "Сила Лоренца", category: "Классическая физика", parent: "magnetism", lat: 12.48, lng: 8.52 },

// Дополнительные параметры
{ id: "resistance", name: "Электрическое сопротивление", category: "Классическая физика", parent: "current", lat: 8.7, lng: 7.6 },
{ id: "capacitors", name: "Конденсаторы", category: "Классическая физика", parent: "electrostatics", lat: 9.8, lng: 7.6 },
{ id: "emf", name: "ЭДС (электродвижущая сила)", category: "Классическая физика", parent: "current", lat: 8.6, lng: 7.8 },
{ id: "power", name: "Мощность тока", category: "Классическая физика", parent: "current", lat: 8.5, lng: 7.7 },
{ id: "energy_density", name: "Плотность энергии поля", category: "Классическая физика", parent: "electrostatics", lat: 12.6, lng: 8.6 },
// Основные законы и теоремы
{ id: "h_theorem", name: "H-теорема Больцмана", category: "Классическая физика", parent: "mkt", lat: 8.6, lng: 8.0 },
{ id: "gas_laws", name: "Газовые законы", category: "Классическая физика", parent: "mkt", lat: 8.4, lng: 8.2 },

// Подтемы газовых законов
{ id: "boyle_mariotte", name: "Закон Бойля-Мариотта", category: "Классическая физика", parent: "gas_laws", lat: 8.5, lng: 8.3 },
{ id: "charles_law", name: "Закон Шарля", category: "Классическая физика", parent: "gas_laws", lat: 8.5, lng: 8.1 },
{ id: "dalton_law", name: "Закон Дальтона", category: "Классическая физика", parent: "gas_laws", lat: 8.7, lng: 8.3 },

// Кинетические параметры
{ id: "molecular_motion", name: "Движение молекул", category: "Классическая физика", parent: "mkt", lat: 8.8, lng: 8.4 },
{ id: "mean_free_path", name: "Длина свободного пробега", category: "Классическая физика", parent: "molecular_motion", lat: 8.9, lng: 8.5 },
{ id: "molecular_speeds", name: "Скорости молекул", category: "Классическая физика", parent: "molecular_motion", lat: 8.7, lng: 8.6 },

// Уравнения состояния
{ id: "state_equations", name: "Уравнения состояния", category: "Классическая физика", parent: "mkt", lat: 8.2, lng: 8.4 },
{ id: "clausius_clapeyron", name: "Уравнение Клаузиуса-Клапейрона", category: "Классическая физика", parent: "state_equations", lat: 8.1, lng: 8.5 },
{ id: "mendeleev_clapeyron", name: "Уравнение Менделеева-Клапейрона", category: "Классическая физика", parent: "state_equations", lat: 8.3, lng: 8.5 },

// Влажность и теплота

{ id: "atomic_structure", name: "Строение атома", category: "Квантовая физика", parent: "quantum_basics", lat: 1.8, lng: 8.2 },
{ id: "quantum_moments", name: "Квантовые моменты", category: "Квантовая физика", parent: "atomic_structure", lat: 1.6, lng: 8.4 },
{ id: "orbital_moment", name: "Орбитальный момент", category: "Квантовая физика", parent: "quantum_moments", lat: 1.5, lng: 8.5 },
{ id: "spin_moment", name: "Спиновый момент", category: "Квантовая физика", parent: "quantum_moments", lat: 1.7, lng: 8.5 },
{ id: "photon_properties", name: "Свойства фотонов", category: "Квантовая физика", parent: "quantum_basics", lat: 2.0, lng: 8.0 },
{ id: "photon_energy", name: "Энергия фотона", category: "Квантовая физика", parent: "photon_properties", lat: 5.55, lng: 9.3 },
{ id: "compton_wavelength", name: "Комптоновская длина волны", category: "Квантовая физика", parent: "photon_properties", lat: 1.9, lng: 8.1 },
{ id: "bohr_radius", name: "Боровский радиус", category: "Квантовая физика", parent: "atomic_structure", lat: 1.9, lng: 8.3 },
{ id: "planck_formula", name: "Формула Планка", category: "Квантовая физика", parent: "quantum_physics", lat: 3.7, lng: 10.0 },
{ id: "mass_defect", name: "Дефект массы ядра", category: "Будущее физики", parent: "nuclear_physics", lat: 3.2, lng: 9.5 },
{ id: "proton_mass", name: "Масса протона", category: "Будущее физики", parent: "quantum_thermo", lat: 3.0, lng: 9.7 },
{ id: "decay_law", name: "Закон радиоактивного распада", category: "Будущее физики", parent: "nuclear_relations", lat: 3.4, lng: 9.3 },

{ id: "humidity", name: "Влажность газов", category: "Классическая физика", parent: "mkt", lat: 8.0, lng: 8.6 },
{ id: "absolute_humidity", name: "Абсолютная влажность", category: "Классическая физика", parent: "humidity", lat: 7.9, lng: 8.4 },
{ id: "heat_quantity", name: "Количество теплоты", category: "Классическая физика", parent: "thermodynamics", lat: 8.2, lng: 8.1 },

// В массив nodes
{ id: "g_constant", name: "Гравитационная постоянная (G)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.0, lng: 5.0, description: "6.67430×10⁻¹¹ м³·кг⁻¹·с⁻² - определяет силу гравитационного взаимодействия" },
{ id: "free_fall_accel", name: "Ускорение свободного падения (g)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.1, lng: 5.1, description: "9.80665 м/с² (стандартное значение на Земле)" },
{ id: "bohr_radius", name: "Боровский радиус (a₀)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.2, lng: 5.2, description: "5.29177210903×10⁻¹¹ м - радиус электронной орбиты в модели Бора" },
{ id: "proton_mass", name: "Масса протона (mₚ)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.3, lng: 5.3, description: "1.67262192369×10⁻²⁷ кг" },
{ id: "neutron_mass", name: "Масса нейтрона (mₙ)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.4, lng: 5.4, description: "1.67492749804×10⁻²⁷ кг" },
{ id: "electron_mass", name: "Масса электрона (mₑ)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.5, lng: 5.5, description: "9.1093837015×10⁻³¹ кг" },
{ id: "planck_constant", name: "Постоянная Планка (h)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.6, lng: 5.6, description: "6.62607015×10⁻³⁴ Дж·с - фундаментальный квант действия" },
{ id: "fine_structure", name: "Постоянная тонкой структуры (α)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.7, lng: 5.7, description: "≈1/137 - характеризует силу электромагнитного взаимодействия" },
{ id: "elementary_charge", name: "Элементарный заряд (e)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.8, lng: 5.8, description: "1.602176634×10⁻¹⁹ Кл - заряд электрона" },
{ id: "speed_of_light", name: "Скорость света (c)", category: "Классическая физика", parent: "fundamental_constants", lat: 6.9, lng: 5.9, description: "299792458 м/с - максимальная скорость распространения информации" },
{ id: "avogadro_number", name: "Число Авогадро (Nₐ)", category: "Классическая физика", parent: "fundamental_constants", lat: 7.0, lng: 6.0, description: "6.02214076×10²³ моль⁻¹ - количество частиц в одном моле вещества" },
{ id: "gas_constant", name: "Универсальная газовая постоянная (R)", category: "Классическая физика", parent: "fundamental_constants", lat: 7.1, lng: 6.1, description: "8.314462618 Дж·моль⁻¹·К⁻¹ - связывает энергию и температуру в газах" },

];

    // Связи между узлами (все сделаны бледно-серыми)
    const connections = [

// Квантовая физика (исправленные связи)
  {source: 'planck_formula', target: 'quantum_basics', color: '#dddddd'},
  {source: 'planck_formula', target: 'photon_energy', color: '#dddddd'},
  {source: 'planck_formula', target: 'quantum_optics', color: '#dddddd'},
  {source: 'quantum_basics', target: 'wave_particle', color: '#dddddd'},
  {source: 'quantum_basics', target: 'schrodinger', color: '#dddddd'},

  // Термодинамика и МКТ (актуальные связи)
  {source: 'mkt', target: 'ideal_gas', color: '#dddddd'},
  {source: 'mkt', target: 'maxwell', color: '#dddddd'},
  {source: 'thermodynamics', target: 'mkt', color: '#dddddd'},
  {source: 'thermodynamics', target: 'entropy', color: '#dddddd'},

  // Электромагнетизм (проверенные связи)
  {source: 'electromagnetism', target: 'electrostatics', color: '#dddddd'},
  {source: 'electromagnetism', target: 'current', color: '#dddddd'},
  {source: 'electromagnetism', target: 'magnetism', color: '#dddddd'},
  {source: 'magnetism', target: 'lorentz_force', color: '#dddddd'}, // Исправлено lorenz → lorentz
  {source: 'current', target: 'ohm_law', color: '#dddddd'},

  // Оптика (валидные связи)
  {source: 'optics', target: 'geo_optics', color: '#dddddd'},
  {source: 'optics', target: 'wave_optics', color: '#dddddd'},
  {source: 'light_laws', target: 'wien_law', color: '#dddddd'},
  {source: 'light_laws', target: 'rayleigh_jeans', color: '#dddddd'},

  // Механика (ключевые связи)
  {source: 'mechanics', target: 'kinematics', color: '#dddddd'},
  {source: 'mechanics', target: 'dynamics', color: '#dddddd'},
  {source: 'dynamics', target: 'newton_laws', color: '#dddddd'},
  {source: 'kinematics', target: 'uniform_motion', color: '#dddddd'},

  // Ядерная физика (сохраненные связи)
  {source: 'nuclear_physics', target: 'nuclear_relations', color: '#dddddd'},
  {source: 'nuclear_relations', target: 'moment_ratio_relation', color: '#dddddd'},

  // Философия (проверенные связи)
  {source: 'philosophy_core', target: 'quantum_philosophy', color: '#dddddd'},
  {source: 'philosophy_core', target: 'determinism', color: '#dddddd'},

  // Междисциплинарные связи (исправленные)
  {source: 'quantum_basics', target: 'special', color: '#dddddd'}, // Квантовая ↔ СТО
  {source: 'thermodynamics', target: 'quantum_thermo', color: '#dddddd'}, // Термодинамика ↔ Квантовая
  {source: 'maxwell', target: 'light_characteristics', color: '#dddddd'}, // Максвелл ↔ Оптика

{source: 'planck_formula', target: 'quantum_basics', color: '#dddddd'}, // Связь с основами квантовой физики
{source: 'planck_formula', target: 'photon_properties', color: '#dddddd'}, // Связь со свойствами фотонов
{source: 'planck_formula', target: 'photon_energy', color: '#dddddd'}, // Связь с энергией фотона
{source: 'planck_formula', target: 'quantum_optics', color: '#dddddd'}, // Связь с квантовой оптикой

    

  
// В массив connections
{source: 'mkt', target: 'h_theorem', color: '#dddddd'},
{source: 'mkt', target: 'gas_laws', color: '#dddddd'},
{source: 'gas_laws', target: 'boyle_mariotte', color: '#dddddd'},
{source: 'gas_laws', target: 'charles_law', color: '#dddddd'},
{source: 'gas_laws', target: 'dalton_law', color: '#dddddd'},

{source: 'mkt', target: 'molecular_motion', color: '#dddddd'},
{source: 'molecular_motion', target: 'mean_free_path', color: '#dddddd'},
{source: 'molecular_motion', target: 'molecular_speeds', color: '#dddddd'},

{source: 'mkt', target: 'state_equations', color: '#dddddd'},
{source: 'state_equations', target: 'clausius_clapeyron', color: '#dddddd'},
{source: 'state_equations', target: 'mendeleev_clapeyron', color: '#dddddd'},

{source: 'mkt', target: 'humidity', color: '#dddddd'},
{source: 'humidity', target: 'absolute_humidity', color: '#dddddd'},
{source: 'thermodynamics', target: 'heat_quantity', color: '#dddddd'},

    // В массив connections
{source: 'electromagnetism', target: 'electric_charge', color: '#dddddd'},
{source: 'electromagnetism', target: 'electric_fields', color: '#dddddd'},
{source: 'electromagnetism', target: 'circuit_laws', color: '#dddddd'},
{source: 'electromagnetism', target: 'current_interaction', color: '#dddddd'},
{source: 'electromagnetism', target: 'capacitance', color: '#dddddd'},

{source: 'magnetism', target: 'biot_savart', color: '#dddddd'},
{source: 'current', target: 'ohm_law', color: '#dddddd'},
{source: 'magnetism', target: 'faraday_law', color: '#dddddd'},
{source: 'current', target: 'kirchhoff_laws', color: '#dddddd'},
{source: 'magnetism', target: 'lorentz_force', color: '#dddddd'},

{source: 'current', target: 'resistance', color: '#dddddd'},
{source: 'electrostatics', target: 'capacitors', color: '#dddddd'},
{source: 'current', target: 'emf', color: '#dddddd'},
{source: 'current', target: 'power', color: '#dddddd'},
{source: 'electrostatics', target: 'energy_density', color: '#dddddd'},

      // Связи для ядерной физики
{source: 'nuclear_physics', target: 'nuclear_characteristics', color: '#dddddd'},
{source: 'nuclear_physics', target: 'nuclear_relations', color: '#dddddd'},
{source: 'transport', target: 'diffusion_phenomena', color: '#dddddd'},

// Связи внутри групп
{source: 'nuclear_characteristics', target: 'gyromagnetic_ratio', color: '#dddddd'},
{source: 'nuclear_characteristics', target: 'nuclear_magnetic_moment', color: '#dddddd'},
{source: 'diffusion_phenomena', target: 'diffusion_equation', color: '#dddddd'},
{source: 'nuclear_relations', target: 'moment_ratio_relation', color: '#dddddd'},
{source: 'nuclear_relations', target: 'diffusion_applications', color: '#dddddd'},

// Связи с существующими элементами
{source: 'gyromagnetic_ratio', target: 'nuclear_magnetic_moment', color: '#dddddd'},
{source: 'magnetism', target: 'nuclear_magnetic_moment', color: '#dddddd'},
{source: 'statistical_physics', target: 'diffusion_equation', color: '#dddddd'},
{source: 'maxwell', target: 'diffusion_equation', color: '#dddddd'},

      // Добавить в массив connections
{source: 'optics', target: 'light_characteristics', color: '#dddddd'},
{source: 'optics', target: 'light_sources', color: '#dddddd'},
{source: 'optics', target: 'optical_params', color: '#dddddd'},
{source: 'optics', target: 'spatial_params', color: '#dddddd'},
{source: 'optics', target: 'light_laws', color: '#dddddd'},
{source: 'optics', target: 'light_relations', color: '#dddddd'},

// Связи внутри групп
{source: 'light_characteristics', target: 'wavelength_visible', color: '#dddddd'},
{source: 'light_characteristics', target: 'wave_number', color: '#dddddd'},
{source: 'light_characteristics', target: 'light_intensity', color: '#dddddd'},
{source: 'light_characteristics', target: 'refractive_index', color: '#dddddd'},
{source: 'light_characteristics', target: 'photometric_quantities', color: '#dddddd'},

{source: 'light_sources', target: 'luminous_intensity', color: '#dddddd'},
{source: 'light_sources', target: 'luminosity', color: '#dddddd'},
{source: 'light_sources', target: 'brightness', color: '#dddddd'},
{source: 'light_sources', target: 'illuminance', color: '#dddddd'},
{source: 'light_sources', target: 'lens_characteristics', color: '#dddddd'},

{source: 'optical_params', target: 'focal_length', color: '#dddddd'},
{source: 'optical_params', target: 'optical_power', color: '#dddddd'},
{source: 'optical_params', target: 'angular_characteristics', color: '#dddddd'},

{source: 'spatial_params', target: 'solid_angle', color: '#dddddd'},

{source: 'light_laws', target: 'malus_law', color: '#dddddd'},
{source: 'light_laws', target: 'wien_law', color: '#dddddd'},
{source: 'light_laws', target: 'rayleigh_jeans', color: '#dddddd'},

{source: 'light_relations', target: 'intensity_angle', color: '#dddddd'},
{source: 'light_relations', target: 'illuminance_intensity', color: '#dddddd'},
{source: 'light_relations', target: 'brightness_luminosity', color: '#dddddd'},

// Связи с существующими элементами
{source: 'maxwell', target: 'light_characteristics', color: '#dddddd'},
{source: 'photometry', target: 'photometric_quantities', color: '#dddddd'},
{source: 'geo_optics', target: 'lens_characteristics', color: '#dddddd'},
{source: 'geo_optics', target: 'optical_params', color: '#dddddd'},
{source: 'wave_optics', target: 'light_characteristics', color: '#dddddd'},


      
      // Философия - внутренние связи
      {source: 'philosophy_core', target: 'ontology', color: '#dddddd'},
      {source: 'philosophy_core', target: 'epistemology', color: '#dddddd'},
      {source: 'philosophy_core', target: 'metaphysics', color: '#dddddd'},
      {source: 'philosophy_core', target: 'objective_reality', color: '#dddddd'},
      {source: 'philosophy_core', target: 'dark_matter_ontology', color: '#dddddd'},
      {source: 'philosophy_core', target: 'observer_role', color: '#dddddd'},
      {source: 'philosophy_core', target: 'scientific_method', color: '#dddddd'},
      {source: 'philosophy_core', target: 'time_metaphysics', color: '#dddddd'},
      {source: 'philosophy_core', target: 'anthropic_principle', color: '#dddddd'},
      {source: 'philosophy_core', target: 'quantum_philosophy', color: '#dddddd'},
      {source: 'philosophy_core', target: 'relativity_philosophy', color: '#dddddd'},
      {source: 'philosophy_core', target: 'consciousness_philosophy', color: '#dddddd'},
      {source: 'philosophy_core', target: 'determinism', color: '#dddddd'},
      {source: 'philosophy_core', target: 'field_nature', color: '#dddddd'},
      {source: 'philosophy_core', target: 'reality_nature', color: '#dddddd'},
      {source: 'philosophy_core', target: 'mathematical_methods', color: '#dddddd'},
      // Добавить в массив connections
{source: 'oscillations', target: 'wave_characteristics', color: '#dddddd'},
{source: 'harmonic', target: 'pendulum_types', color: '#dddddd'},
{source: 'harmonic', target: 'oscillation_params', color: '#dddddd'},
{source: 'electromagnetism', target: 'em_oscillations', color: '#dddddd'},
{source: 'mech_waves', target: 'wave_speeds', color: '#dddddd'},
{source: 'mech_waves', target: 'wave_effects', color: '#dddddd'},
{source: 'mech_waves', target: 'wave_relations', color: '#dddddd'},
// Дополнительные связи между параметрами

      // Классическая физика - внутренние связи
      {source: 'classical_core', target: 'mechanics', color: '#dddddd'},
      {source: 'classical_core', target: 'thermodynamics', color: '#dddddd'},
      {source: 'classical_core', target: 'electromagnetism', color: '#dddddd'},
      {source: 'classical_core', target: 'optics', color: '#dddddd'},
      {source: 'classical_core', target: 'analytical_mech', color: '#dddddd'},
      {source: 'classical_core', target: 'statistical_physics', color: '#dddddd'},
      {source: 'classical_core', target: 'nuclear_physics', color: '#dddddd'},
      {source: 'classical_core', target: 'condensed_matter', color: '#dddddd'},

      // Механика
      {source: 'mechanics', target: 'kinematics', color: '#dddddd'},
      {source: 'mechanics', target: 'dynamics', color: '#dddddd'},
      {source: 'mechanics', target: 'conservation', color: '#dddddd'},
      {source: 'mechanics', target: 'oscillations', color: '#dddddd'},
      {source: 'mechanics', target: 'statics', color: '#dddddd'},
      {source: 'mechanics', target: 'analytical_mech', color: '#dddddd'},

      // Кинематика
      {source: 'kinematics', target: 'kinematics_motion', color: '#dddddd'},
      {source: 'kinematics', target: 'kinematics_rotation', color: '#dddddd'},
      {source: 'kinematics', target: 'kinematics_relativity', color: '#dddddd'},
       {source: 'kinematics_motion', target: 'uniform_motion', color: '#dddddd'},
  {source: 'kinematics_motion', target: 'accel_motion', color: '#dddddd'},
  {source: 'kinematics_motion', target: 'free_fall', color: '#dddddd'},
  
  // Связи для динамики
  {source: 'forces', target: 'friction_forces', color: '#dddddd'},
  {source: 'equilibrium', target: 'lever_principle', color: '#dddddd'},
  
  // Связи для статики
  {source: 'pressure', target: 'liquid_pressure', color: '#dddddd'},
  
  // Связи для электромагнетизма
  {source: 'maxwell_eq', target: 'em_flux_density', color: '#dddddd'},

      // Динамика
      {source: 'dynamics', target: 'newton_laws', color: '#dddddd'},
      {source: 'dynamics', target: 'forces', color: '#dddddd'},
      {source: 'dynamics', target: 'complex_forces', color: '#dddddd'},

      // Законы сохранения
      {source: 'conservation', target: 'energy', color: '#dddddd'},
      {source: 'conservation', target: 'momentum', color: '#dddddd'},
      {source: 'conservation', target: 'angular_momentum', color: '#dddddd'},

      // Колебания и волны
      {source: 'oscillations', target: 'harmonic', color: '#dddddd'},
      {source: 'oscillations', target: 'damped', color: '#dddddd'},
      {source: 'oscillations', target: 'mech_waves', color: '#dddddd'},

      // Статика
      {source: 'statics', target: 'equilibrium', color: '#dddddd'},
      {source: 'statics', target: 'pressure', color: '#dddddd'},
      {source: 'statics', target: 'archimedes', color: '#dddddd'},

      // Термодинамика
      {source: 'thermodynamics', target: 'thermo_laws', color: '#dddddd'},
      {source: 'thermodynamics', target: 'entropy', color: '#dddddd'},
      {source: 'thermodynamics', target: 'heat_machines', color: '#dddddd'},
      {source: 'thermodynamics', target: 'mkt', color: '#dddddd'},

      // МКТ
      {source: 'mkt', target: 'ideal_gas', color: '#dddddd'},
      {source: 'mkt', target: 'maxwell', color: '#dddddd'},
      {source: 'mkt', target: 'transport', color: '#dddddd'},

      // Электромагнетизм
      {source: 'electromagnetism', target: 'electrostatics', color: '#dddddd'},
      {source: 'electromagnetism', target: 'current', color: '#dddddd'},
      {source: 'electromagnetism', target: 'magnetism', color: '#dddddd'},
      {source: 'electromagnetism', target: 'maxwell_eq', color: '#dddddd'},

      // Оптика
      {source: 'optics', target: 'geo_optics', color: '#dddddd'},
      {source: 'optics', target: 'wave_optics', color: '#dddddd'},
      {source: 'optics', target: 'photometry', color: '#dddddd'},

      // Аналитическая механика
      {source: 'analytical_mech', target: 'lagrange', color: '#dddddd'},
      {source: 'analytical_mech', target: 'hamilton', color: '#dddddd'},
      {source: 'analytical_mech', target: 'celestial', color: '#dddddd'},

      // Другие разделы
      {source: 'phase_transitions', target: 'thermodynamics', color: '#dddddd'},
      {source: 'phase_transitions', target: 'mkt', color: '#dddddd'},
      {source: 'phase_transitions', target: 'statistical_physics', color: '#dddddd'},
      {source: 'statistical_physics', target: 'thermodynamics', color: '#dddddd'},
      {source: 'nuclear_physics', target: 'thermodynamics', color: '#dddddd'},
      {source: 'condensed_matter', target: 'statistical_physics', color: '#dddddd'},

      // Квантовая физика - внутренние связи
      {source: 'quantum_core', target: 'quantum_basics', color: '#dddddd'},
      {source: 'quantum_core', target: 'atomic_physics', color: '#dddddd'},
      {source: 'quantum_core', target: 'quantum_effects', color: '#dddddd'},
      {source: 'quantum_core', target: 'qft', color: '#dddddd'},
      {source: 'quantum_core', target: 'quantum_apps', color: '#dddddd'},
      {source: 'quantum_core', target: 'particle_physics', color: '#dddddd'},

      // Основы квантовой физики
      {source: 'quantum_basics', target: 'wave_particle', color: '#dddddd'},
      {source: 'quantum_basics', target: 'schrodinger', color: '#dddddd'},
      {source: 'quantum_basics', target: 'uncertainty', color: '#dddddd'},
      {source: 'quantum_basics', target: 'wave_function', color: '#dddddd'},
      {source: 'quantum_basics', target: 'hilbert_space', color: '#dddddd'},

      // Атомная физика
      {source: 'atomic_physics', target: 'bohr_model', color: '#dddddd'},
      {source: 'atomic_physics', target: 'quantum_numbers', color: '#dddddd'},
      {source: 'atomic_physics', target: 'electron_spin', color: '#dddddd'},
      {source: 'atomic_physics', target: 'pauli', color: '#dddddd'},

      // Квантовые эффекты
      {source: 'quantum_effects', target: 'tunneling', color: '#dddddd'},
      {source: 'quantum_effects', target: 'entanglement', color: '#dddddd'},
      {source: 'quantum_effects', target: 'superposition', color: '#dddddd'},
      {source: 'quantum_effects', target: 'aharonov_bohm', color: '#dddddd'},

      // Квантовая теория поля
      {source: 'qft', target: 'qed', color: '#dddddd'},
      {source: 'qft', target: 'qcd', color: '#dddddd'},
      {source: 'qft', target: 'standard_model', color: '#dddddd'},
      {source: 'qft', target: 'higgs', color: '#dddddd'},

      // Приложения квантовой физики
      {source: 'quantum_apps', target: 'quantum_computing', color: '#dddddd'},
      {source: 'quantum_apps', target: 'quantum_crypto', color: '#dddddd'},
      {source: 'quantum_apps', target: 'quantum_sensors', color: '#dddddd'},
      {source: 'quantum_apps', target: 'quantum_thermo', color: '#dddddd'},
      {source: 'quantum_apps', target: 'quantum_optics', color: '#dddddd'},

      // Теория относительности - внутренние связи
      {source: 'relativity_core', target: 'special', color: '#dddddd'},
      {source: 'relativity_core', target: 'general', color: '#dddddd'},
      {source: 'relativity_core', target: 'cosmology', color: '#dddddd'},

      // Специальная теория относительности
      {source: 'special', target: 'postulates', color: '#dddddd'},
      {source: 'special', target: 'lorenz', color: '#dddddd'},
      {source: 'special', target: 'effects', color: '#dddddd'},
      {source: 'special', target: 'energy_momentum', color: '#dddddd'},

      // Эффекты СТО
      {source: 'effects', target: 'dilation', color: '#dddddd'},
      {source: 'effects', target: 'length_contraction', color: '#dddddd'},

      // Общая теория относительности
      {source: 'general', target: 'equivalence', color: '#dddddd'},
      {source: 'general', target: 'einstein_eq', color: '#dddddd'},
      {source: 'general', target: 'black_holes', color: '#dddddd'},
      {source: 'general', target: 'grav_waves', color: '#dddddd'},

      // Космология
      {source: 'cosmology', target: 'dark_matter', color: '#dddddd'},
      {source: 'cosmology', target: 'dark_energy', color: '#dddddd'},
      {source: 'cosmology', target: 'universe_evolution', color: '#dddddd'},

      // Будущее физики - внутренние связи
      {source: 'future_core', target: 'quantum_gravity', color: '#dddddd'},
      
            // Будущее физики - внутренние связи
            {source: 'future_core', target: 'beyond_standard', color: '#dddddd'},
      {source: 'future_core', target: 'quantum_tech', color: '#dddddd'},
      {source: 'future_core', target: 'fusion', color: '#dddddd'},
      {source: 'future_core', target: 'accelerators', color: '#dddddd'},
      {source: 'future_core', target: 'medical_physics', color: '#dddddd'},
      {source: 'future_core', target: 'neurophysics', color: '#dddddd'},
      {source: 'future_core', target: 'multiverse', color: '#dddddd'},
      {source: 'future_core', target: 'ai_physics', color: '#dddddd'},
      {source: 'future_core', target: 'tech_control', color: '#dddddd'},
      {source: 'future_core', target: 'scientific_status', color: '#dddddd'},
      {source: 'future_core', target: 'neutron_stars', color: '#dddddd'},
      {source: 'future_core', target: 'superconductivity', color: '#dddddd'},
      {source: 'future_core', target: 'semiconductors', color: '#dddddd'},
      {source: 'future_core', target: 'particle_accelerators', color: '#dddddd'},
      {source: 'future_core', target: 'chaos_theory', color: '#dddddd'},

      // Квантовая гравитация
      {source: 'quantum_gravity', target: 'string_theory', color: '#dddddd'},
      {source: 'quantum_gravity', target: 'loop_gravity', color: '#dddddd'},

      // Физика за пределами Стандартной модели
      {source: 'beyond_standard', target: 'neutrino', color: '#dddddd'},

      // Квантовые технологии
      {source: 'quantum_tech', target: 'quantum_information', color: '#dddddd'},
      {source: 'quantum_tech', target: 'quantum_simulators', color: '#dddddd'},

      // Пропасть незнания - внутренние связи
      {source: 'unknown_core', target: 'measurement_problem', color: '#dddddd'},
      {source: 'unknown_core', target: 'time_nature', color: '#dddddd'},
      {source: 'unknown_core', target: 'consciousness', color: '#dddddd'},
      {source: 'unknown_core', target: 'hierarchy', color: '#dddddd'},
      {source: 'unknown_core', target: 'anthropic', color: '#dddddd'},
      {source: 'unknown_core', target: 'time_arrow', color: '#dddddd'},
      {source: 'unknown_core', target: 'wave_collapse', color: '#dddddd'},
      {source: 'unknown_core', target: 'spacetime_discrete', color: '#dddddd'},
      {source: 'unknown_core', target: 'local_realism', color: '#dddddd'},
      {source: 'unknown_core', target: 'crisis_cosmology', color: '#dddddd'},

      // Междисциплинарные связи
      // Философия ↔ Классическая физика
      {source: 'objective_reality', target: 'newton_laws', color: '#dddddd'},
      {source: 'anthropic_principle', target: 'entropy', color: '#dddddd'},
      {source: 'time_metaphysics', target: 'thermodynamics', color: '#dddddd'},
      {source: 'field_nature', target: 'maxwell_eq', color: '#dddddd'},

      // Философия ↔ Квантовая физика
      {source: 'quantum_philosophy', target: 'quantum_basics', color: '#dddddd'},
      {source: 'observer_role', target: 'measurement_problem', color: '#dddddd'},
      {source: 'determinism', target: 'wave_function', color: '#dddddd'},

      // Философия ↔ Теория относительности
      {source: 'relativity_philosophy', target: 'special', color: '#dddddd'},
      {source: 'time_metaphysics', target: 'general', color: '#dddddd'},
      {source: 'reality_nature', target: 'cosmology', color: '#dddddd'},

      // Классическая физика ↔ Квантовая физика
      {source: 'mechanics', target: 'quantum_basics', color: '#dddddd'},
      {source: 'electromagnetism', target: 'qed', color: '#dddddd'},
      {source: 'thermodynamics', target: 'quantum_thermo', color: '#dddddd'},
      {source: 'optics', target: 'quantum_optics', color: '#dddddd'},

      // Классическая физика ↔ Теория относительности
      {source: 'mechanics', target: 'special', color: '#dddddd'},
      {source: 'electromagnetism', target: 'general', color: '#dddddd'},
      {source: 'celestial', target: 'cosmology', color: '#dddddd'},

      // Квантовая физика ↔ Теория относительности
      {source: 'quantum_basics', target: 'special', color: '#dddddd'},
      {source: 'quantum_effects', target: 'general', color: '#dddddd'},
      {source: 'qft', target: 'cosmology', color: '#dddddd'},

      // Все ↔ Будущее физики
      {source: 'future_core', target: 'philosophy_core', color: '#dddddd'},
      {source: 'future_core', target: 'classical_core', color: '#dddddd'},
      {source: 'future_core', target: 'quantum_core', color: '#dddddd'},
      {source: 'future_core', target: 'relativity_core', color: '#dddddd'},
      {source: 'future_core', target: 'unknown_core', color: '#dddddd'},

      // Все ↔ Пропасть незнания
      {source: 'unknown_core', target: 'philosophy_core', color: '#dddddd'},
      {source: 'unknown_core', target: 'classical_core', color: '#dddddd'},
      {source: 'unknown_core', target: 'quantum_core', color: '#dddddd'},
      {source: 'unknown_core', target: 'relativity_core', color: '#dddddd'},

      // Новые пограничные темы (мосты между разделами)
      // Квантовая термодинамика
      {source: 'thermodynamics', target: 'quantum_information', color: '#dddddd'},
      {source: 'entropy', target: 'entanglement', color: '#dddddd'},
      {source: 'thermo_laws', target: 'measurement_problem', color: '#dddddd'},

      // Релятивистская квантовая механика
      {source: 'schrodinger', target: 'dirac_equation', color: '#dddddd'},
      {source: 'dirac_equation', target: 'special', color: '#dddddd'},
      {source: 'qft', target: 'lorenz', color: '#dddddd'},

      // Биофизика
      {source: 'quantum_effects', target: 'photosynthesis', color: '#dddddd'},
      {source: 'photosynthesis', target: 'energy', color: '#dddddd'},
      {source: 'neurophysics', target: 'quantum_sensors', color: '#dddddd'},

      // Астрофизика
      {source: 'black_holes', target: 'quantum_gravity', color: '#dddddd'},
      {source: 'cosmic_rays', target: 'standard_model', color: '#dddddd'},

      // Хаотические системы
      {source: 'determinism', target: 'chaos_theory', color: '#dddddd'},
      {source: 'chaos_theory', target: 'quantum_chaos', color: '#dddddd'},
      
      // Гидродинамика
      {source: 'hydrodynamics', target: 'navier_stokes', color: '#dddddd'},
      {source: 'navier_stokes', target: 'quantum_fluids', color: '#dddddd'},

      // Квантовые алгоритмы
      {source: 'quantum_algorithms', target: 'quantum_information', color: '#dddddd'},
      {source: 'quantum_algorithms', target: 'mathematical_methods', color: '#dddddd'},

      // Топологические изоляторы
      {source: 'topological_insulators', target: 'condensed_matter', color: '#dddddd'},
      {source: 'topological_insulators', target: 'general', color: '#dddddd'},

      // Голографический принцип
      {source: 'holographic_principle', target: 'string_theory', color: '#dddddd'},
      {source: 'holographic_principle', target: 'black_holes', color: '#dddddd'},
      {source: 'holographic_principle', target: 'quantum_information', color: '#dddddd'},

      // Интерпретации вероятности
      {source: 'probability_interpretations', target: 'copenhagen', color: '#dddddd'},
      {source: 'probability_interpretations', target: 'statistical_physics', color: '#dddddd'},

      // Квантовая биология
      {source: 'quantum_biology', target: 'photosynthesis', color: '#dddddd'},
      {source: 'quantum_biology', target: 'quantum_coherence', color: '#dddddd'},
      {source: 'magnetic_sense', target: 'electron_spin', color: '#dddddd'},

      // Квантовый мозг
      {source: 'quantum_mind', target: 'consciousness', color: '#dddddd'},
      {source: 'quantum_mind', target: 'superposition', color: '#dddddd'},

      // Археофизика
      {source: 'archaeophysics', target: 'nuclear_physics', color: '#dddddd'},

      // Практические приложения
      {source: 'mri_technology', target: 'electron_spin', color: '#dddddd'},
      {source: 'mri_technology', target: 'medical_physics', color: '#dddddd'},
      {source: 'solar_cells', target: 'thermodynamics', color: '#dddddd'},
      {source: 'gps_systems', target: 'special', color: '#dddddd'},
      {source: 'gps_systems', target: 'celestial', color: '#dddddd'},

      // Исторические связи
      {source: 'least_action', target: 'analytical_mech', color: '#dddddd'},
      {source: 'least_action', target: 'feynman_path', color: '#dddddd'},
      {source: 'ether_theories', target: 'maxwell_eq', color: '#dddddd'},
      {source: 'ether_theories', target: 'special', color: '#dddddd'},
      // Перекрестные связи с другими разделами


    ];

    // Описания для всех узлов
    const descriptions = {
  /* Атомные константы */
  'bohr_radius': 'Характерный размер электронной орбиты в модели Бора (≈5.29×10⁻¹¹ м)',
  'rydberg_energy': 'Энергия ионизации атома водорода (≈13.6 эВ)',
  'electron_radius': 'Классический радиус электрона (≈2.82×10⁻¹⁵ м)',

  /* Ядерные параметры */
  'nuclear_defect': 'Разница между массой ядра и суммой масс нуклонов (E=mc²)',
  'binding_energy': 'Энергия связи нуклонов в ядре (≈8 МэВ/нуклон)',
  'fission_barrier': 'Порог деления тяжёлых ядер (≈6 МэВ)',

  /* Квантовые эффекты */
  'compton_wavelength': 'λ = h/mₑc ≈ 2.43×10⁻¹² м (длина волны рассеяния фотонов)',
  'debroglie_wave': 'λ = h/p (волновая природа частиц)',
  'quantum_tunnel': 'Вероятность преодоления потенциального барьера',

  /* Фундаментальные формулы */
  'planck_formula': 'E = hν (основа квантовой теории)',
  'schrodinger_eq': 'iℏ∂Ψ/∂t = ĤΨ (уравнение динамики квантовых систем)',
  'dirac_equation': 'Релятивистское описание электрона (γ·p + mc)ψ = 0',

  /* Экспериментальные константы */
  'josephson_freq': 'Частота в эффекте Джозефсона (483.6 ТГц/В)',
  'quantum_hall': 'Квантовое сопротивление (h/e² ≈ 25.8 кОм)',

      'bohr_radius': 'Характерный размер электронной орбиты в модели Бора (≈5.29×10⁻¹¹ м)',
'nuclear_defect': 'Разница между массой ядра и суммой масс нуклонов (E=mc²)',
'compton_wavelength': 'λ = h/mₑc ≈ 2.43×10⁻¹² м (длина волны рассеяния фотонов)',
'planck_formula': 'E = hν (основа квантовой теории)',
'h_theorem': 'Теорема, показывающая возрастание энтропии в замкнутой системе (Больцман)',
'gas_laws': 'Основные законы, описывающие поведение газов при различных условиях',
'boyle_mariotte': 'P₁V₁ = P₂V₂ (при постоянной температуре)',
'charles_law': 'V/T = const (при постоянном давлении)',
'dalton_law': 'Закон парциальных давлений в газовых смесях',
'molecular_motion': 'Хаотическое движение молекул - основа МКТ',
'mean_free_path': 'Среднее расстояние, проходимое молекулой между столкновениями',
'molecular_speeds': 'Распределение скоростей молекул (Максвелл)',
'state_equations': 'Уравнения, связывающие параметры состояния системы',
'clausius_clapeyron': 'Уравнение фазового равновесия',
'mendeleev_clapeyron': 'PV = nRT (уравнение состояния идеального газа)',
'humidity': 'Характеристики содержания водяного пара в газе',
'absolute_humidity': 'Масса водяного пара в единице объема воздуха',
'heat_quantity': 'Энергия, передаваемая при теплообмене',

'electric_charge': 'Фундаментальное свойство материи, определяющее электромагнитное взаимодействие. Бывает положительным и отрицательным.',
'electric_fields': 'Поле, создаваемое электрическими зарядами, определяющее силу, действующую на другие заряды.',
'circuit_laws': 'Основные законы, описывающие поведение электрических цепей: Ома, Кирхгофа, Джоуля-Ленца.',
'current_interaction': 'Взаимодействие параллельных токов через магнитные поля (притяжение/отталкивание).',
'capacitance': 'Способность проводника накапливать заряд. Характеризуется отношением заряда к потенциалу.',

'biot_savart': 'Закон, определяющий магнитное поле, создаваемое током в произвольной точке пространства.',
'ohm_law': 'Основной закон электрических цепей: сила тока пропорциональна напряжению и обратно пропорциональна сопротивлению.',
'faraday_law': 'Закон электромагнитной индукции: ЭДС индукции пропорциональна скорости изменения магнитного потока.',
'kirchhoff_laws': 'Два правила для анализа электрических цепей: правило токов и правило напряжений.',
'lorentz_force': 'Сила, действующая на заряженную частицу в электромагнитном поле.',

'resistance': 'Свойство материала препятствовать прохождению электрического тока.',
'capacitors': 'Устройства для накопления заряда и энергии электрического поля.',
'emf': 'Работа сторонних сил по перемещению единичного заряда в источнике тока.',
'power': 'Скорость преобразования электрической энергии в другие формы.',
'energy_density': 'Энергия электрического поля, приходящаяся на единицу объема.',

      // Ядерная физика
'nuclear_characteristics': 'Основные характеристики атомных ядер и их магнитных свойств',
'gyromagnetic_ratio': 'Отношение магнитного момента ядра к его механическому моменту (спину)',
'nuclear_magnetic_moment': 'Векторная величина, характеризующая взаимодействие ядра с внешним магнитным полем',

// Диффузионные явления
'diffusion_phenomena': 'Процессы распространения частиц или энергии в среде с неоднородной концентрацией',
'diffusion_equation': 'Уравнение в частных производных, описывающее изменение концентрации вещества в процессе диффузии',

// Взаимосвязи
'nuclear_relations': 'Основные соотношения между параметрами ядерных систем',
'moment_ratio_relation': 'Связь между магнитным моментом ядра и его гидромагнитным отношением: μ = g·(eħ/2m)·I',
'diffusion_applications': 'Применение диффузионных моделей в физике, химии и биологии',
      // Добавить в объект descriptions
'light_characteristics': 'Основные физические параметры, описывающие свойства света',
'wavelength_visible': 'Диапазон длин волн, воспринимаемых человеческим глазом (400-760 нанометров)',
'wave_number': 'Пространственная частота волны, измеряемая в радианах на единицу длины',
'light_intensity': 'Мощность световой энергии, переносимой волной через единицу площади',
'refractive_index': 'Отношение скорости света в вакууме к скорости света в среде',
'photometric_quantities': 'Величины, характеризующие свет с точки зрения его восприятия человеческим глазом',

'light_sources': 'Характеристики, описывающие свойства источников света',
'luminous_intensity': 'Световой поток, излучаемый источником в заданном направлении',
'luminosity': 'Полная энергия, излучаемая источником света в единицу времени',
'brightness': 'Световая отдача поверхности в заданном направлении',
'illuminance': 'Световой поток, падающий на единицу поверхности',
'lens_characteristics': 'Параметры, описывающие свойства оптических линз',

'optical_params': 'Основные параметры оптических систем',
'focal_length': 'Расстояние от оптического центра до фокуса линзы или зеркала',
'optical_power': 'Величина, обратная фокусному расстоянию, измеряемая в диоптриях',
'angular_characteristics': 'Угловые параметры оптических систем и световых пучков',

'spatial_params': 'Пространственные характеристики светового излучения',
'solid_angle': 'Часть пространства, ограниченная конической поверхностью',

'light_laws': 'Фундаментальные законы, описывающие свойства света',
'malus_law': 'Закон, определяющий интенсивность поляризованного света после прохождения через анализатор',
'wien_law': 'Закон, описывающий зависимость длины волны максимума излучения от температуры тела',
'rayleigh_jeans': 'Формула, описывающая спектральную плотность излучения абсолютно чёрного тела',

'light_relations': 'Основные соотношения между параметрами света',
'intensity_angle': 'Зависимость силы света от телесного угла излучения',
'illuminance_intensity': 'Связь между освещённостью поверхности и силой света источника',
'brightness_luminosity': 'Соотношение между яркостью поверхности и её светимостью',
      // Добавить в объект descriptions
'wave_characteristics': 'Основные параметры, описывающие волновые процессы: амплитуда, длина волны, фазовая скорость и другие',
'amplitude': 'Максимальное отклонение колеблющейся величины от положения равновесия',
'wavelength': 'Расстояние между двумя ближайшими точками волны, колеблющимися в одинаковой фазе',
'phase_velocity': 'Скорость перемещения фазы волны в пространстве',
'surface_tension': 'Коэффициент, характеризующий силу поверхностного натяжения жидкости',

'pendulum_types': 'Различные типы маятников, используемые для изучения колебательных процессов',
'math_pendulum': 'Идеализированная система, состоящая из материальной точки на невесомой нити',
'phys_pendulum': 'Реальное физическое тело, совершающее колебания около оси вращения',
'torsion_pendulum': 'Маятник, колебания которого происходят за счёт сил упругости при кручении',
'spring_pendulum': 'Система, состоящая из груза, подвешенного на пружине',

'oscillation_params': 'Основные характеристики колебательных процессов',
'oscillation_period': 'Время одного полного колебания',
'angular_frequency': 'Скорость изменения фазы колебаний, измеряемая в радианах в секунду',
'frequency': 'Количество полных колебаний в единицу времени',

'em_oscillations': 'Колебания электрического и магнитного полей в электромагнитной волне',
'em_period': 'Время одного полного колебания электромагнитного поля',
'resonance_frequency': 'Частота, при которой амплитуда колебаний достигает максимума',

'wave_speeds': 'Скорости распространения различных типов волн в разных средах',
'sound_speed_gas': 'Скорость распространения звуковой волны в газообразной среде',
'electricity_speed': 'Скорость распространения электрического сигнала в проводнике',
'em_wave_speed': 'Скорость распространения электромагнитных волн в веществе',
'phase_wave_speed': 'Скорость перемещения фазы волны',

'wave_effects': 'Явления, возникающие при распространении волн',
'doppler_effect': 'Изменение частоты волны при движении источника или наблюдателя',
'pause_law': 'Закон, описывающий затухание волн в различных средах',

'wave_relations': 'Основные соотношения между параметрами волновых процессов',
'period_frequency': 'Обратная зависимость между периодом и частотой колебаний',
'wave_speed_relation': 'Связь скорости волны с её длиной и частотой: v = λν',
'medium_properties': 'Влияние плотности, упругости и других свойств среды на скорость волны',
      // Философские категории
      'philosophy_core': 'Философские основания физики: онтологические, эпистемологические и метафизические проблемы',
      'ontology': 'Исследование природы реальности и существования физических объектов',
      'epistemology': 'Изучение границ и методов физического познания',
      'metaphysics': 'Философское исследование фундаментальных категорий пространства, времени и причинности',
      'objective_reality': 'Дебаты о существовании объективной реальности в квантовой механике',
      'dark_matter_ontology': 'Философский статус тёмной материи: реальный объект или теоретическая конструкция?',
      'observer_role': 'Роль наблюдателя в квантовых измерениях и проблема измерения',
      'scientific_method': 'Пределы научного познания в условиях недоступности эксперимента',
      'time_metaphysics': 'Природа времени: фундаментальная сущность или эмерджентное свойство?',
      'anthropic_principle': 'Философские интерпретации антропного принципа в космологии',
      'quantum_philosophy': 'Философские интерпретации квантовой механики: от Копенгагена до многомировой',
      'relativity_philosophy': 'Философские следствия теории относительности: реляционная vs субстанциальная природа пространства-времени',
      'consciousness_philosophy': 'Проблема сознания в физике: эмерджентность vs фундаментальность',
      'mathematical_methods': 'Философские основы математического моделирования в физике',

      // Классическая физика
      'mechanics': 'Фундаментальный раздел классической физики',
      'kinematics': 'Описание движения тел без учета сил',
      'kinematics_motion': 'Равномерное и равноускоренное движение материальной точки',
      'kinematics_rotation': 'Угловая скорость и центростремительное ускорение',
      'kinematics_relativity': 'Преобразования Галилея и относительность движения',
      'dynamics': 'Изучение сил и их воздействия на движение',
      'newton_laws': 'Три закона Ньютона - основа классической механики',
      'forces': 'Гравитационные, упругие силы и силы трения',
      'complex_forces': 'Движение по наклонной плоскости и другие примеры',
      'conservation': 'Фундаментальные законы сохранения',
      'energy': 'Кинетическая и потенциальная энергия, работа силы',
      'momentum': 'Закон сохранения импульса и виды столкновений',
      'angular_momentum': 'Момент импульса и гироскопический эффект',
      'oscillations': 'Изучение колебательных систем',
      'harmonic': 'Математический и пружинный маятники',
      'damped': 'Затухающие колебания и явление резонанса',
      'mech_waves': 'Продольные и поперечные волны, звук',
      'statics': 'Равновесие тел под действием сил',
      'equilibrium': 'Условия равновесия тел и правило рычага',
      'pressure': 'Закон Паскаля и сообщающиеся сосуды',
      'archimedes': 'Закон Архимеда и условия плавания тел',
      'thermodynamics': 'Наука о тепле и энергии',
      'thermo_laws': 'Основные законы термодинамики',
      'entropy': 'Второй закон термодинамики и энтропия',
      'heat_machines': 'Цикл Карно и КПД тепловых машин',
      'mkt': 'Молекулярно-кинетическая теория',
      'ideal_gas': 'Уравнение состояния идеального газа',
      'maxwell': 'Распределение молекул по скоростям и энергиям',
      'transport': 'Диффузия, теплопроводность и вязкость',
      'electromagnetism': 'Электромагнитные взаимодействия',
      'electrostatics': 'Электрические заряды в покое',
      'current': 'Законы Ома и Кирхгофа для электрических цепей',
      'magnetism': 'Магнитные поля и их свойства',
      'maxwell_eq': 'Система уравнений электромагнитного поля',
      'optics': 'Наука о свете и его свойствах',
      'geo_optics': 'Распространение световых лучей',
      'wave_optics': 'Волновая природа света',
      'photometry': 'Световой поток, освещенность и яркость',
      'analytical_mech': 'Аналитические методы механики',
      'lagrange': 'Уравнения Лагранжа и обобщенные координаты',
      'hamilton': 'Принцип наименьшего действия Гамильтона',
      'celestial': 'Законы Кеплера и движение небесных тел',
      'nuclear_physics': 'Физика атомных ядер: структура, реакции, распады',
      'statistical_physics': 'Статистическое описание многочастичных систем',
      'condensed_matter': 'Физика твёрдого тела и жидких кристаллов',

      // Квантовая физика
      'quantum_core': 'Фундаментальная теория, описывающая поведение микрочастиц',
      'quantum_basics': 'Фундаментальные принципы квантовой механики',
      'wave_particle': 'Дуализм волна-частица: объекты проявляют свойства и волн, и частиц',
      'schrodinger': 'Фундаментальное уравнение, описывающее эволюцию квантовых систем',
      'uncertainty': 'Невозможность одновременного точного измерения некоторых пар величин',
      'wave_function': 'Вероятностное описание квантового состояния системы',
      'hilbert_space': 'Математическое пространство состояний квантовой системы',
      'atomic_physics': 'Квантовое описание строения атомов',
      'bohr_model': 'Полуквантовая модель атома c фиксированными орбитами электронов',
      'quantum_numbers': 'Набор параметров, определяющих квантовое состояние частицы',
      'electron_spin': 'Внутренний момент импульса электрона',
      'pauli': 'Запрет на нахождение двух фермионов в одинаковых квантовых состояниях',
      'quantum_effects': 'Квантовые явления, нарушающие классическую интуицию',
      'tunneling': 'Прохождение частиц через потенциальные барьеры, запрещённые классически',
      'entanglement': 'Корреляция состояний частиц, сохраняющаяся на больших расстояниях',
      'superposition': 'Способность квантовой системы находиться в нескольких состояниях одновременно',
      'aharonov_bohm': 'Влияние электромагнитного потенциала на квантовую фазу частицы',
      'qft': 'Релятивистская квантовая теория, описывающая поля и их взаимодействия',
      'qed': 'Квантовая электродинамика - теория взаимодействия света и вещества',
      'qcd': 'Квантовая хромодинамика - теория сильного взаимодействия',
      'standard_model': 'Современная теория, объединяющая все фундаментальные взаимодействия',
      'higgs': 'Частица, отвечающая за массу элементарных частиц через поле Хиггса',
      'quantum_apps': 'Практическое применение квантовых эффектов в технологиях',
      'quantum_computing': 'Использование квантовых состояний для выполнения вычислений',
      'quantum_crypto': 'Защищённые методы связи на основе квантовых принципов',
      'quantum_sensors': 'Высокоточные измерительные устройства на квантовых эффектах',
      'quantum_thermo': 'Исследование термодинамических процессов в квантовых системах',
      'particle_physics': 'Изучение элементарных частиц и их взаимодействий',

      // Теория относительности и космология
      'relativity_core': 'Фундаментальная теория пространства-времени и гравитации',
      'postulates': 'Принцип относительности и постоянство скорости света',
      'lorenz': 'Преобразования координат между инерциальными системами',
      'effects': 'Релятивистские эффекты при больших скоростях',
      'dilation': 'Замедление времени для движущихся наблюдателей',
      'length_contraction': 'Сокращение длины в направлении движения',
      'energy_momentum': 'Релятивистские энергия и импульс',
      'equivalence': 'Эквивалентность гравитационной и инертной масс',
      'einstein_eq': 'Уравнения связи материи с геометрией пространства',
      'black_holes': 'Сингулярности и горизонты событий',
      'grav_waves': 'Колебания пространства-времени от массивных тел',
      'cosmology': 'Космологические модели и эволюция Вселенной',
      'experiments': 'Экспериментальные подтверждения теории',
      'applications': 'Практическое применение в астрофизике и технологиях',

      // Перспективные направления и будущее физики
      'future_core': 'Фундаментальные проблемы и перспективные направления физики XXI века',
      'quantum_gravity': 'Основная проблема современной физики - объединение квантовой механики и ОТО. Основные подходы: теория струн, петлевая квантовая гравитация, теория причинных множеств.',
      'string_theory': 'Гипотеза одномерных струн, вибрирующих в 10-11 измерениях. Суперсимметрия, М-теория, голографический принцип.',
      'loop_gravity': 'Дискретная квантовая структура пространства-времени. Спиновая пена и квантованные объёмы.',
      'dark_energy': 'Загадочная энергия, вызывающая ускоренное расширение Вселенной. ΛCDM модель и альтернативные теории.',
      'dark_matter': 'Невидимая масса, влияющая на динамику галактик. WIMPs, аксионы, эксперименты прямого обнаружения.',
      'beyond_standard': 'Поиск новой физики: суперсимметрия, дополнительные измерения, теории Великого объединения.',
      'neutrino': 'Изучение массы нейтрино, осцилляций и возможной Майорановской природы.',
      'quantum_tech': 'Квантовые компьютеры, криптография, сенсоры нового поколения.',
      'fusion': 'Управляемый термоядерный синтез - энергетика будущего. Токамаки и лазерные системы.',
      'neurophysics': 'Изучение физических основ работы мозга. Включает: нейровизуализацию, моделирование нейросетей, квантовые процессы в нейронах. Физические модели биологических систем: от молекул до организмов. Исследование мышления, сознания и когнитивных процессов.',
      'superconductivity': 'Явление нулевого электрического сопротивления',
      'semiconductors': 'Материалы с управляемой электропроводностью',
      'particle_accelerators': 'Установки для изучения фундаментальных частиц',
      'medical_physics': 'Применение физических методов в медицине: МРТ, лучевая терапия, нейроинтерфейсы',
      'chaos_theory': 'Изучение сложных нелинейных динамических систем',

      // Фундаментальные проблемы и нерешённые вопросы
      'unknown_core': 'Фундаментальные нерешённые проблемы современной физики',
      'measurement_problem': 'Парадокс коллапса волновой функции и роль наблюдателя',
      'time_nature': 'Природа временной стрелы и связь с энтропией',
      'consciousness': 'Связь квантовых процессов с нейробиологией сознания',
      'hierarchy': 'Проблема огромного разрыва между масштабами фундаментальных сил',
      'anthropic': 'Философские аспекты тонкой настройки Вселенной',
      'time_arrow': 'Проблема асимметрии времени в фундаментальных законах физики',
      'wave_collapse': 'Интерпретация процесса измерения в квантовой механике',
      'spacetime_discrete': 'Гипотеза о дискретной структуре пространства-времени',
      'local_realism': 'Парадокс ЭПР и проблемы локальности в квантовой теории',
      'crisis_cosmology': 'Противоречия в современных космологических моделях',

      // Новые описания
      'dirac_equation': 'Релятивистское уравнение квантовой механики, объединяющее СТО и квантовую теорию',
      'quantum_biology': 'Изучение квантовых эффектов в биологических системах',
      'photosynthesis': 'Квантовая когерентность в процессе фотосинтеза',
      'cosmic_rays': 'Высокоэнергетические частицы из космоса - лаборатория для проверки физических теорий',
      'quantum_chaos': 'Изучение хаотического поведения в квантовых системах',
      'hydrodynamics': 'Физика движения жидкостей и газов',
      'navier_stokes': 'Фундаментальные уравнения гидродинамики',
      'quantum_fluids': 'Жидкости, проявляющие квантовые свойства (например, сверхтекучесть)',
      'quantum_algorithms': 'Алгоритмы, использующие квантовые принципы для ускорения вычислений',
      'topological_insulators': 'Материалы с топологически защищенными поверхностными состояниями',
      'holographic_principle': 'Идея, что информация в объеме может быть описана на его границе',
      'probability_interpretations': 'Философские интерпретации вероятности в физике',
      'copenhagen': 'Копенгагенская интерпретация квантовой механики',
      'quantum_coherence': 'Сохранение квантовых фазовых соотношений в системе',
      'magnetic_sense': 'Гипотеза о квантовых механизмах магниторецепции у птиц',
      'quantum_mind': 'Спекулятивная гипотеза о квантовой природе сознания',
      'archaeophysics': 'Применение физических методов в археологии',
      'mri_technology': 'Магнитно-резонансная томография - приложение квантовой физики',
      'solar_cells': 'Фотоэлектрические преобразователи энергии',
      'gps_systems': 'Глобальные системы позиционирования с учетом релятивистских эффектов',
      'least_action': 'Фундаментальный принцип физики, объединяющий разные разделы',
      'feynman_path': 'Формулировка квантовой механики через интегралы по траекториям',
      'ether_theories': 'Исторические концепции эфира и их современные аналоги'
    };

    // Дополнительные данные для модальных окон
    const additionalData = {
      // Историческая справка
      variables: {
    'philosophy_core': 'Онтологический статус, эпистемологический подход, метафизические основания',
    'classical_core': 'Масса, скорость, ускорение, сила, энергия, импульс, момент инерции',
    'quantum_core': 'Волновая функция, спин, квантовые числа, амплитуда вероятности, операторы',
    'relativity_core': 'Интервал, тензор энергии-импульса, метрический тензор, кривизна',
    'future_core': 'Параметры квантовой гравитации, константы взаимодействий, размерность пространства',
    'unknown_core': 'Вероятностные величины, скрытые параметры, фундаментальные константы'
  },
      
      history: {
        'philosophy_core': 'Философские вопросы физики обсуждались еще древнегреческими философами, такими как Аристотель и Демокрит.',
        'classical_core': 'Классическая физика сформировалась в XVII-XIX веках благодаря работам Ньютона, Максвелла и других ученых.',
        'quantum_core': 'Квантовая механика зародилась в начале XX века благодаря Планку, Эйнштейну, Бору и Шрёдингеру.',
        'relativity_core': 'Теория относительности была разработана Альбертом Эйнштейном в 1905 (СТО) и 1915 (ОТО) годах.',
        'future_core': 'Современные исследования в физике направлены на решение фундаментальных проблем, оставшихся нерешенными в XX веке.',
        'unknown_core': 'Многие фундаментальные вопросы остаются без ответа, несмотря на огромный прогресс физики за последние столетия.'
      },
      
      // Практическое применение
      applications: {
        'philosophy_core': 'Философские концепции помогают формировать научную методологию и интерпретировать сложные физические теории.',
        'classical_core': 'Применяется в инженерии, строительстве, транспорте и других областях повседневной жизни.',
        'quantum_core': 'Лежит в основе современных технологий: лазеры, транзисторы, МРТ, квантовые компьютеры.',
        'relativity_core': 'Используется в GPS-навигации, астрофизике и при расчетах ускорителей частиц.',
        'future_core': 'Перспективные технологии: термоядерная энергетика, квантовые коммуникации, новые материалы.',
        'unknown_core': 'Решение этих проблем может привести к революционным технологическим прорывам.'
      },
      
      // Изображения для карусели (URL или base64)
      images: {
        'philosophy_core': [
          'https://example.com/philosophy1.jpg',
          'https://example.com/philosophy2.jpg'
        ],
        'classical_core': [
          'https://example.com/classical1.jpg',
          'https://example.com/classical2.jpg'
        ],
        'quantum_core': [
          'https://example.com/quantum1.jpg',
          'https://example.com/quantum2.jpg'
        ],
        'relativity_core': [
          'https://example.com/relativity1.jpg',
          'https://example.com/relativity2.jpg'
        ],
        'future_core': [
          'https://example.com/future1.jpg',
          'https://example.com/future2.jpg'
        ],
        'unknown_core': [
          'https://example.com/unknown1.jpg',
          'https://example.com/unknown2.jpg'
        ]
      }
    };

    // Текущее состояние карусели
    let carouselState = {
      currentIndex: 0,
      totalItems: 0
    };

    // Функция для проверки, находится ли точка внутри полигона
    function isPointInPolygon(point, polygon) {
      const x = point[0], y = point[1];
      let inside = false;
      for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
        const xi = polygon[i][0], yi = polygon[i][1];
        const xj = polygon[j][0], yj = polygon[j][1];
        
        const intersect = ((yi > y) !== (yj > y))
          && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
      }
      return inside;
    }

    // Функция для нахождения случайной точки внутри полигона
    function getRandomPointInPolygon(polygon) {
      // Находим границы полигона
      let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
      polygon.forEach(point => {
        minX = Math.min(minX, point[0]);
        maxX = Math.max(maxX, point[0]);
        minY = Math.min(minY, point[1]);
        maxY = Math.max(maxY, point[1]);
      });
      
      // Генерируем случайные точки, пока не найдем внутри полигона
      let point;
      do {
        const x = minX + Math.random() * (maxX - minX);
        const y = minY + Math.random() * (maxY - minY);
        point = [x, y];
      } while (!isPointInPolygon(point, polygon));
      
      return point;
    }

    // Функция для вычисления центра полигона
    function getPolygonCenter(coords) {
      let x = 0, y = 0;
      coords.forEach(coord => {
        x += coord[0];
        y += coord[1];
      });
      return [x / coords.length, y / coords.length];
    }

    // Распределяем подтемы внутри зон
    function distributeTopics() {
      const zonePolygons = {};
      zones.forEach(zone => {
        zonePolygons[zone.name] = zone.shape;
      });

      allTopics.forEach(topic => {
        // Если заданы кастомные координаты, используем их
        if (topic.lat !== undefined && topic.lng !== undefined) {
          return;
        }

        const parentNode = [...mainNodes, ...allTopics].find(n => n.id === topic.parent);
        if (!parentNode) return;

        // Для всех категорий гарантируем нахождение внутри своей зоны
        let point;
        let attempts = 0;
        const maxAttempts = 100;
        const zoneShape = zonePolygons[topic.category];
        
        // Определяем центр зоны как резервную позицию
        const zoneCenter = getPolygonCenter(zoneShape);
        const parentPos = parentNode.lat && parentNode.lng 
          ? [parentNode.lat, parentNode.lng] 
          : zoneCenter;

        do {
          // Генерируем точку в радиусе от родительского узла
          const angle = Math.random() * Math.PI * 2;
          const distance = 0.3 + Math.random() * 1.2;
          point = [
            parentPos[0] + Math.cos(angle) * distance,
            parentPos[1] + Math.sin(angle) * distance
          ];
          attempts++;
          
          // Если не удалось найти точку после многих попыток, используем точку около центра зоны
          if (attempts >= maxAttempts) {
            const centerAngle = Math.random() * Math.PI * 2;
            const centerDistance = Math.random() * 0.5;
            point = [
              zoneCenter[0] + Math.cos(centerAngle) * centerDistance,
              zoneCenter[1] + Math.sin(centerAngle) * centerDistance
            ];
            break;
          }
        } while (!isPointInPolygon(point, zoneShape));
        
        topic.lat = point[0];
        topic.lng = point[1];
      });
    }

    // Проверка распределения точек для всех зон
    function validateDistribution() {
      const zoneMap = {};
      zones.forEach(zone => {
        zoneMap[zone.name] = zone.shape;
      });

      allTopics.forEach(topic => {
        // Пропускаем точки с кастомными координатами
        if (topic.lat === undefined || topic.lng === undefined) return;

        const zoneShape = zoneMap[topic.category];
        if (!zoneShape) {
          console.error(`Не найдена зона для категории: ${topic.category}`);
          return;
        }

        if (!isPointInPolygon([topic.lat, topic.lng], zoneShape)) {
          console.warn(`Тема "${topic.name}" (${topic.category}) выходит за границы зоны!`);
          // Автоматическое исправление
          const point = getRandomPointInPolygon(zoneShape);
          topic.lat = point[0];
          topic.lng = point[1];
        }
      });
    }

    // Создаем соединения между точками
    function createConnections() {
      connections.forEach(conn => {
        const sourceNode = [...mainNodes, ...allTopics].find(n => n.id === conn.source);
        const targetNode = [...mainNodes, ...allTopics].find(n => n.id === conn.target);
        
        if (sourceNode && targetNode) {
          const sourcePos = sourceNode.marker ? sourceNode.marker.getLatLng() : [sourceNode.lat, sourceNode.lng];
          const targetPos = targetNode.marker ? targetNode.marker.getLatLng() : [targetNode.lat, targetNode.lng];
          
          const connection = L.polyline(
            [sourcePos, targetPos],
            { 
              color: conn.color || '#dddddd', // Все линии бледно-серые
              weight: 1,
              opacity: 0.4,
              className: 'faded-element connection-line'
            }
          ).addTo(layers.connections);

          // Сохраняем ссылку на соединение
          if (!sourceNode.connections) sourceNode.connections = [];
          if (!targetNode.connections) targetNode.connections = [];
          sourceNode.connections.push(connection);
          targetNode.connections.push(connection);
        }
      });
    }

    // Добавляем все подтемы на карту
    allTopics.forEach(topic => {
      const color = categoryColors[topic.category];
      const parentNode = [...mainNodes, ...allTopics].find(n => n.id === topic.parent);
      
      if (!topic.lat || !topic.lng) return;

      // Маркер подтемы
      const marker = L.circleMarker([topic.lat, topic.lng], {
        radius: 5,
        fillColor: color,
        color: "#fff",
        weight: 0.8,
        opacity: 0.8,
        fillOpacity: 1
      }).addTo(layers.subtopics);

      // Обработчик клика для подтемы
      let lastClickTime = 0;
      marker.on('click', function(e) {
        const now = Date.now();
        if (now - lastClickTime < 300) { // Двойной клик
          resetHighlight();
          lastClickTime = 0;
          return;
        }
        lastClickTime = now;
        
        highlightNode(topic.id);
        showModal(topic);
      });

      // Постоянная подпись
      const label = L.divIcon({
        html: `<div class="node-label">${topic.name}</div>`,
        className: 'node-label-container',
        iconSize: [0, 0]
      });
      
      L.marker([topic.lat, topic.lng], {
        icon: label,
        zIndexOffset: 1000
      }).addTo(layers.labels);

      
      // Связь с родительским узлом
      if (parentNode) {
        const parentPos = parentNode.marker 
          ? parentNode.marker.getLatLng() 
          : [parentNode.lat, parentNode.lng];
        
        const connection = L.polyline(
          [[topic.lat, topic.lng], parentPos],
          { 
            color: '#dddddd', // Бледно-серая линия
            weight: 1,
            opacity: 0.5
          }
        ).addTo(layers.connections);

        // Сохраняем ссылки
        topic.marker = marker;
        topic.connection = connection;
        topic.parentNode = parentNode;
      }
    });

    // Функция для подсветки связанных узлов
    function highlightNode(nodeId) {
      resetHighlight();
      
      const selectedNode = [...mainNodes, ...allTopics].find(n => n.id === nodeId);
      if (!selectedNode) return;
      
      // Подсвечиваем сам выбранный узел
      if (selectedNode.marker) {
        selectedNode.marker.setStyle({
          fillOpacity: 0.9,
          radius: selectedNode.marker.options.radius === 8 ? 10 : 7,
          color: '#fff',
          weight: selectedNode.marker.options.radius === 8 ? 3 : 2
        });
      }

      // Подсвечиваем связи с родителем (если есть)
      if (selectedNode.parentNode) {
        const parentNode = [...mainNodes, ...allTopics].find(n => n.id === selectedNode.parent);
        if (parentNode && parentNode.marker) {
          parentNode.marker.setStyle({
            fillOpacity: 0.9,
            radius: parentNode.marker.options.radius === 8 ? 10 : 7,
            color: '#fff',
            weight: parentNode.marker.options.radius === 8 ? 3 : 2
          });
        }
        if (selectedNode.connection) {
          selectedNode.connection.setStyle({
            color: '#fff',
            opacity: 1,
            weight: 2
          });
        }
      }

      // Подсвечиваем дочерние узлы и их связи
      const childNodes = allTopics.filter(t => t.parent === nodeId);
      childNodes.forEach(child => {
        if (child.marker) {
          child.marker.setStyle({
            fillOpacity: 0.9,
            radius: 7,
            color: '#fff',
            weight: 2
          });
        }
        if (child.connection) {
          child.connection.setStyle({
            color: '#fff',
            opacity: 1,
            weight: 2
          });
        }
      });

      // Подсвечиваем только непосредственные связи из массива connections
      connections.forEach(conn => {
        if (conn.source === nodeId || conn.target === nodeId) {
          const sourceNode = [...mainNodes, ...allTopics].find(n => n.id === (conn.source === nodeId ? conn.target : conn.source));
          if (sourceNode && sourceNode.marker) {
            sourceNode.marker.setStyle({
              fillOpacity: 0.9,
              radius: sourceNode.marker.options.radius === 8 ? 10 : 7,
              color: '#fff',
              weight: sourceNode.marker.options.radius === 8 ? 3 : 2
            });
          }
          
          // Находим и подсвечиваем саму линию соединения
          const connectionLine = findConnectionLine(conn.source, conn.target);
          if (connectionLine) {
            connectionLine.setStyle({
              color: '#fff',
              opacity: 1,
              weight: 2
            });
          }
        }
      });
    }

    // Вспомогательная функция для поиска линии соединения
    function findConnectionLine(sourceId, targetId) {
      for (const layer of layers.connections.getLayers()) {
        const latLngs = layer.getLatLngs();
        if (latLngs.length === 2) {
          const sourcePos = latLngs[0];
          const targetPos = latLngs[1];
          
          const sourceNode = [...mainNodes, ...allTopics].find(n => 
            (n.marker && n.marker.getLatLng().equals(sourcePos)) || 
            (!n.marker && n.lat === sourcePos.lat && n.lng === sourcePos.lng)
          );
          
          const targetNode = [...mainNodes, ...allTopics].find(n => 
            (n.marker && n.marker.getLatLng().equals(targetPos)) || 
            (!n.marker && n.lat === targetPos.lat && n.lng === targetPos.lng)
          );
          
          if ((sourceNode && sourceNode.id === sourceId && targetNode && targetNode.id === targetId) ||
              (sourceNode && sourceNode.id === targetId && targetNode && targetNode.id === sourceId)) {
            return layer;
          }
        }
      }
      return null;
    }

    // Функция для сброса подсветки
    function resetHighlight() {
      allTopics.forEach(topic => {
        if (topic.marker) {
          topic.marker.setStyle({
            fillOpacity: 1,
            radius: 5,
            color: '#fff',
            weight: 1
          });
        }
        if (topic.connection) {
          topic.connection.setStyle({
            color: '#dddddd',
            opacity: 0.5,
            weight: 1
          });
        }
        if (topic.connections) {
          topic.connections.forEach(conn => {
            conn.setStyle({
              color: '#dddddd',
              opacity: 0.4,
              weight: 1
            });
          });
        }
      });
      
      mainNodes.forEach(node => {
        node.marker.setStyle({
          fillOpacity: 1,
          radius: 8,
          color: '#fff',
          weight: 1.5
        });
        if (node.connections) {
          node.connections.forEach(conn => {
            conn.setStyle({
              color: '#dddddd',
              opacity: 0.4,
              weight: 1
            });
          });
        }
      });
    }

    // Функция для обновления карусели изображений
    function updateCarousel(nodeId) {
      const carouselInner = document.getElementById('carousel-inner');
      const carouselIndicators = document.getElementById('carousel-indicators');
      
      // Очищаем карусель
      carouselInner.innerHTML = '';
      carouselIndicators.innerHTML = '';
      
      // Получаем изображения для текущего узла
      const images = additionalData.images[nodeId] || [];
      carouselState.totalItems = images.length;
      carouselState.currentIndex = 0;
      
      // Добавляем изображения в карусель
      images.forEach((imgSrc, index) => {
        const item = document.createElement('div');
        item.className = 'carousel-item';
        item.style.backgroundImage = `url(${imgSrc})`;
        carouselInner.appendChild(item);
        
        // Добавляем индикатор
        const indicator = document.createElement('div');
        indicator.className = 'carousel-indicator';
        if (index === 0) indicator.classList.add('active');
        indicator.addEventListener('click', () => moveCarouselTo(index));
        carouselIndicators.appendChild(indicator);
      });
      
      // Обновляем позицию карусели
      moveCarouselTo(0);
    }

    // Функция для перемещения карусели
    function moveCarousel(direction) {
      const newIndex = carouselState.currentIndex + direction;
      
      // Проверяем границы
      if (newIndex < 0) {
        moveCarouselTo(carouselState.totalItems - 1);
      } else if (newIndex >= carouselState.totalItems) {
        moveCarouselTo(0);
      } else {
        moveCarouselTo(newIndex);
      }
    }

    // Функция для перемещения карусели к конкретному индексу
    function moveCarouselTo(index) {
      if (carouselState.totalItems === 0) return;
      
      // Ограничиваем индекс
      index = (index + carouselState.totalItems) % carouselState.totalItems;
      carouselState.currentIndex = index;
      
      // Обновляем позицию
      const carouselInner = document.getElementById('carousel-inner');
      carouselInner.style.transform = `translateX(-${index * 100}%)`;
      
      // Обновляем индикаторы
      const indicators = document.querySelectorAll('.carousel-indicator');
      indicators.forEach((indicator, i) => {
        if (i === index) {
          indicator.classList.add('active');
        } else {
          indicator.classList.remove('active');
        }
      });
    }

    // Функция для показа модального окна
    // Обновлённая функция showModal
function showModal(node) {
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modal-title');
  const modalDescription = document.getElementById('modal-description');
  const modalHistory = document.getElementById('modal-history');
  const modalApplications = document.getElementById('modal-applications');
  const modalVariables = document.getElementById('modal-variables');
  
  modalTitle.textContent = node.name;
  modalDescription.textContent = descriptions[node.id] || 'Описание отсутствует';
  modalHistory.textContent = additionalData.history[node.id] || 'Историческая справка отсутствует';
  modalApplications.textContent = additionalData.applications[node.id] || 'Информация о применении отсутствует';
  modalVariables.textContent = additionalData.variables[node.id] || 'Данные о переменных отсутствуют';
  
  updateCarousel(node.id);
  modal.style.display = 'flex';
}

    // Обновлённая функция showAdditionalModal
function showAdditionalModal(type) {
  const additionalModal = document.getElementById('additional-modal');
  const additionalModalTitle = document.getElementById('additional-modal-title');
  const additionalModalContent = document.getElementById('additional-modal-content');
  
  let content = '';
  switch(type) {
    case 0:
      additionalModalTitle.textContent = 'Полное описание';
      content = document.getElementById('modal-description').textContent;
      break;
    case 1:
      additionalModalTitle.textContent = 'Историческая справка';
      content = document.getElementById('modal-history').textContent;
      break;
    case 2:
      additionalModalTitle.textContent = 'Практическое применение';
      content = document.getElementById('modal-applications').textContent;
      break;
    case 3:
      additionalModalTitle.textContent = 'Ключевые переменные';
      content = document.getElementById('modal-variables').textContent;
      break;
  }
  
  additionalModalContent.textContent = content;
  additionalModal.style.display = 'flex';
}

    // Обработчик закрытия модального окна
    document.querySelector('.close-modal').addEventListener('click', function() {
      document.getElementById('modal').style.display = 'none';
      
    });

    // Обработчик закрытия дополнительного модального окна
    document.querySelector('.close-additional-modal').addEventListener('click', function() {
      document.getElementById('additional-modal').style.display = 'none';
    });

    // Обработчик клика вне модального окна
    document.getElementById('modal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.style.display = 'none';
        
      }
    });

    // Обработчик клика вне дополнительного модального окна
    document.getElementById('additional-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.style.display = 'none';
      }
    });

    // Обработчик двойного клика на карте
map.on('dblclick', function() {
  resetHighlight();
});

    // Поиск по темам
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      
      allTopics.forEach(topic => {
        if (topic.marker) {
          const content = topic.name.toLowerCase();
          if (content.includes(searchTerm)) {
            topic.marker.setStyle({ fillOpacity: 0.8, radius: 7 });
            if (topic.connection) topic.connection.setStyle({ opacity: 0.8 });
            if (topic.connections) topic.connections.forEach(c => c.setStyle({ opacity: 0.8 }));
          } else {
            topic.marker.setStyle({ fillOpacity: 0.6, radius: 5 });
            if (topic.connection) topic.connection.setStyle({ opacity: 0.3 });
            if (topic.connections) topic.connections.forEach(c => c.setStyle({ opacity: 0.3 }));
          }
        }
      });
    });

    // Управление фильтрами
    function setupFilters() {
      document.querySelectorAll('.category-filter').forEach(filter => {
        filter.addEventListener('change', updateFilters);
      });

      document.querySelectorAll('.element-filter').forEach(filter => {
        filter.addEventListener('change', updateFilters);
      });
    }

    // Обновление фильтров
    function updateFilters() {
      const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked'))
        .map(cb => cb.value);

      const selectedElements = Array.from(document.querySelectorAll('.element-filter:checked'))
        .map(cb => cb.value);

      // Фильтрация по категориям
      allTopics.forEach(topic => {
        const visible = selectedCategories.includes(topic.category);
        if (topic.marker) topic.marker.setStyle({ opacity: visible ? 0.8 : 0 });
        if (topic.connection) topic.connection.setStyle({ opacity: visible ? 0.5 : 0 });
        if (topic.connections) topic.connections.forEach(c => c.setStyle({ opacity: visible ? 0.4 : 0 }));
      });

      
      // Управление слоями
      

      if (selectedElements.includes('nodes')) {
        map.addLayer(layers.nodes);
        map.addLayer(layers.nodeGlows);
      } else {
        map.removeLayer(layers.nodes);
        map.removeLayer(layers.nodeGlows);
      }

      if (selectedElements.includes('subtopics')) {
        map.addLayer(layers.subtopics);
      } else {
        map.removeLayer(layers.subtopics);
      }

      if (selectedElements.includes('connections')) {
        map.addLayer(layers.connections);
      } else {
        map.removeLayer(layers.connections);
      }

      map.addLayer(layers.labels);
    }

    // Настройка системы масштабирования для заголовков
    function updateLabelsVisibility() {
      const currentZoom = map.getZoom();
      const maxZoomForNodeLabels = 7;
      const minZoomForZoneLabels = 1;
      
      let nodeOpacity = 0;
      let nodeFontSize = 8;
      if (currentZoom >= maxZoomForNodeLabels) {
        nodeOpacity = 0.9;
        nodeFontSize = 11;
      } else if (currentZoom >= maxZoomForNodeLabels - 1) {
        nodeOpacity = 0.9 * (currentZoom - (maxZoomForNodeLabels - 1));
        nodeFontSize = 8 + 3 * (currentZoom - (maxZoomForNodeLabels - 1));
      }
      
      let zoneOpacity = 0;
      let zoneFontSize = 10;
      if (currentZoom <= minZoomForZoneLabels) {
        zoneOpacity = 0.8;
        zoneFontSize = 13;
      } else if (currentZoom <= minZoomForZoneLabels + 2) {
        zoneOpacity = 0.8 * (1 - (currentZoom - minZoomForZoneLabels) / 2);
        zoneFontSize = 10 + 3 * (1 - (currentZoom - minZoomForZoneLabels) / 2);
      }
      
      document.querySelectorAll('.node-label').forEach(label => {
        label.style.opacity = nodeOpacity;
        label.style.fontSize = `${nodeFontSize}px`;
      });
      
      document.querySelectorAll('.zone-label').forEach(label => {
        label.style.opacity = zoneOpacity;
        label.style.fontSize = `${zoneFontSize}px`;
      });
    }

    // Инициализация
    distributeTopics();
    validateDistribution();
    setupFilters();
    createConnections();
    map.on('zoomend', updateLabelsVisibility);
    map.fitBounds([[3, 3], [13, 13]]);
    updateLabelsVisibility();

    // Сворачивание групп фильтров
    document.querySelectorAll('.filter-group-title').forEach(title => {
      title.addEventListener('click', () => {
        title.parentElement.classList.toggle('collapsed');
      });
    });

    // Добавляем обработчики свайпа для карусели
    let touchStartX = 0;
    let touchEndX = 0;
    
    const carousel = document.querySelector('.image-carousel');
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, false);
    
    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, false);
    
    function handleSwipe() {
      const threshold = 50; // Минимальное расстояние свайпа
      
      if (touchStartX - touchEndX > threshold) {
        // Свайп влево - следующее изображение
        moveCarousel(1);
      } else if (touchEndX - touchStartX > threshold) {
        // Свайп вправо - предыдущее изображение
        moveCarousel(-1);
      }
    }
  </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>